<!-- file: flowforge.html (works on GitHub Pages as-is) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Launch Control — 14-Day AI Business</title>
  <meta name="description" content="Professional 14-Day Launch Control checklist app with Firebase sync."/>
  <style>
    :root{
      --bg:#0b1020; --muted:#10162a; --card:#0f172a; --text:#e6f0ff; --dim:#a9b6d3;
      --blue:#3b82f6; --green:#10b981; --purple:#8b5cf6; --red:#ef4444; --border:#1f2a44;
      --grad: linear-gradient(135deg,var(--blue), var(--green), var(--purple));
      --shadow: 0 10px 30px rgba(0,0,0,.35); --radius:14px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:
      radial-gradient(1200px 800px at 15% -10%,rgba(59,130,246,.18),transparent),
      radial-gradient(1200px 800px at 85% 110%,rgba(139,92,246,.16),transparent), var(--bg);
      color:var(--text); font:14px/1.5 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial}
    a{color:var(--blue)} .wrap{max-width:1100px;margin:0 auto;padding:24px}
    .header{display:flex;align-items:center;gap:16px;padding:16px 20px;
      background:linear-gradient(0deg,rgba(16,22,42,.65),rgba(16,22,42,.65)),var(--grad);
      border-radius:18px; box-shadow:var(--shadow)}
    .title{font-weight:700;font-size:20px;letter-spacing:.2px}
    .subtitle{opacity:.9;font-size:12px}
    .bar{margin:16px 0 22px;background:linear-gradient(135deg,rgba(59,130,246,.15),rgba(16,185,129,.15),rgba(139,92,246,.15));
      border:1px solid var(--border); padding:14px; border-radius:14px; display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    .pill{display:inline-flex;gap:8px;align-items:center; padding:6px 10px; border-radius:999px;
      background:#0e162b; border:1px solid var(--border); color:var(--dim); font-size:12px}
    .pill.ok{background:rgba(16,185,129,.1); color:#b8f8dd; border-color:rgba(16,185,129,.35)}
    .pill.warn{background:rgba(59,130,246,.1); color:#cfe1ff; border-color:rgba(59,130,246,.35)}
    .pill.err{background:rgba(239,68,68,.1); color:#ffd0d0; border-color:rgba(239,68,68,.35)}
    .actions{margin-left:auto; display:flex; gap:8px}
    button{all:unset; display:inline-flex; align-items:center; gap:8px; padding:10px 12px; background:var(--card); border:1px solid var(--border); border-radius:12px; cursor:pointer}
    button:hover{background:#121a31} .btn-primary{background:var(--grad); color:white; border:none}
    .grid{display:grid; grid-template-columns: 280px 1fr; gap:16px}
    .card{background:linear-gradient(180deg,rgba(16,22,42,.65),rgba(16,22,42,.75)); border:1px solid var(--border); border-radius:14px; padding:14px; box-shadow:var(--shadow)}
    .sticky{position:sticky; top:14px} .h{margin:0 0 10px; font-size:13px; color:#cfe1ff; letter-spacing:.3px; text-transform:uppercase}
    .progress{height:10px; background:#0b1429; border:1px solid var(--border); border-radius:999px; overflow:hidden}
    .progress > span{display:block; height:100%; background:var(--grad)}
    .search,input[type="text"],input[type="email"],textarea{width:100%; background:#0b1429; border:1px solid var(--border); border-radius:10px; color:var(--text); padding:10px}
    .day{border:1px solid var(--border); border-radius:16px; overflow:hidden; margin-bottom:12px}
    .day summary{list-style:none; cursor:pointer; padding:14px 14px; background:rgba(11,20,41,.55); display:flex; align-items:center; gap:10px}
    .day summary::-webkit-details-marker{display:none}
    .k{display:inline-flex; width:20px; height:20px; align-items:center; justify-content:center; border-radius:6px; background:rgba(59,130,246,.18); border:1px solid rgba(59,130,246,.4); color:#cfe1ff; font-weight:700}
    .task{display:flex; gap:12px; align-items:flex-start; padding:12px; border-top:1px solid var(--border); background:rgba(10,16,32,.35)}
    .check{width:18px;height:18px;border-radius:5px;border:1px solid var(--border); background:#0d1530; display:inline-flex; align-items:center; justify-content:center; cursor:pointer}
    .check.done{background:linear-gradient(135deg,rgba(16,185,129,.7),rgba(59,130,246,.7))}
    .task-title{font-weight:600} .muted{color:var(--dim); font-size:12px}
    .drawer{padding:12px 12px 14px 38px; display:grid; gap:10px; background:rgba(12,18,34,.5); border-top:1px dashed #253253}
    .sub{display:flex; gap:8px; align-items:center} .sub input{accent-color:#10b981; width:16px; height:16px}
    .list{display:grid; gap:6px} .badge{font-size:10px; padding:2px 6px; border-radius:999px; background:#0c1530; border:1px solid var(--border); color:#cfe1ff}
    .link{display:flex; gap:8px; align-items:center} .footer{opacity:.6; font-size:12px; margin-top:8px}
    .code{background:#0a1328; border:1px solid var(--border); border-radius:10px; padding:10px; overflow:auto}
    .alert{padding:10px 12px; border-radius:10px; border:1px solid rgba(16,185,129,.35); background:rgba(16,185,129,.08); color:#b8f8dd; font-size:12px}
    .error-overlay{position:fixed;bottom:12px;left:12px;max-width:520px;background:#2b0b13;border:1px solid rgba(239,68,68,.45);color:#ffd0d0;padding:10px 12px;border-radius:10px;font:12px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;z-index:9999;box-shadow:0 6px 20px rgba(0,0,0,.4)}
    @media (max-width: 900px){ .grid{grid-template-columns:1fr} .sticky{position:static} }
  </style>
  <!-- React (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Firebase compat (UMD) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
</head>
<body>
  <div id="root"></div>
  <div id="err" class="error-overlay" style="display:none"></div>

  <script>
    // Show runtime errors in-page (so GH Pages issues are visible).
    window.addEventListener("error", e => {
      const el = document.getElementById("err");
      el.textContent = "Error: " + (e.error?.message || e.message);
      el.style.display = "block";
    });

    const deepClone = (v) => JSON.parse(JSON.stringify(v));
    const debounce = (fn, ms=500) => { let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); } };
    const nowIso = ()=> new Date().toISOString();

    // Seed (shortened per day)
    const SEED={days:[{day:1,title:"Niche & Foundations",tasks:[
      {id:"d1t1",title:"Confirm niche + teardown 3 competitors",desc:"Pick DTC micro-brands. Document gaps → hooks.",
        subtasks:[{id:"d1t1s1",t:"Pick niche & alternates"},{id:"d1t1s2",t:"3 competitor teardowns"},{id:"d1t1s3",t:"Decide ICP & angles"}],
        prompts:[
          "Give me a concise ICP for {{brand}} targeting {{niche}}: pains, triggers, messages.",
          "Tear down {{url}}: list 5 copy fixes and 3 friction removals."
        ],
        links:[{label:"Competitor Sheet (copy)",url:"https://docs.google.com"}]
      },
      {id:"d1t2",title:"Create Run Log & Dashboard shells",desc:"Observability from Day 1; UK GDPR minimal fields.",
        subtasks:[{id:"d1t2s1",t:"Create Google Sheet: Run Log"},{id:"d1t2s2",t:"Create Dashboard tabs"},{id:"d1t2s3",t:"Add UTM columns"}],
        prompts:["Design a lightweight metrics schema for K-factor, MRR, churn, signups."],
        links:[{label:"Metrics schema guide",url:"#dashboard-spec"}]
      }]}/* ... rest of 14 days kept identical to previous message ... */]};

    // Your Firebase config
    const FIREBASE_CONFIG = {
      apiKey:"AIzaSyChiAlrD-JLtBSDN3sOyxYiLGig-6Cy3GM",
      authDomain:"prospecting-f2f42.firebaseapp.com",
      databaseURL:"https://prospecting-f2f42-default-rtdb.europe-west1.firebasedatabase.app/",
      projectId:"prospecting-f2f42",
      storageBucket:"prospecting-f2f42.appspot.com",          // safer default bucket host
      messagingSenderId:"292034226428",
      appId:"1:292034226428:web:878b867e3eb4d3e0098f79",
      measurementId:"G-WWB0JTX2L2"
    };

    const LS_KEY="lc-data", LS_PROFILE="lc-profile";

    function ensureFirebase(){
      // Guard: if CDN blocked/slow, app still loads offline.
      if(!window.firebase){ return {available:false, auth:null, db:null}; }
      if(!firebase.apps.length){ firebase.initializeApp(FIREBASE_CONFIG); }
      return {available:true, auth:firebase.auth(), db:firebase.database()};
    }

    function deepMerge(a,b){
      if(Array.isArray(a)&&Array.isArray(b)) return b.length?b:a;
      if(a&&typeof a==='object' && b&&typeof b==='object'){ const o={...a}; for(const k of Object.keys(b)){ o[k]=deepMerge(a[k],b[k]); } return o; }
      return (b===undefined)?a:b;
    }

    function App(){
      const {useEffect,useMemo,useState,useRef,createElement: h, Fragment} = React;
      const [profile,setProfile]=useState(()=>JSON.parse(localStorage.getItem(LS_PROFILE)||"{}")||{});
      const [data,setData]=useState(()=>JSON.parse(localStorage.getItem(LS_KEY)||"null")||deepClone(SEED));
      const [uid,setUid]=useState(null);
      const [saveState,setSaveState]=useState({status:"idle",ts:null,msg:""});
      const [conn,setConn]=useState({online:navigator.onLine,firebase:"init"});
      const [q,setQ]=useState("");
      const [openTask,setOpenTask]=useState(null);
      const dbPath = useMemo(()=> uid ? `users/${uid}/projects/default` : null, [uid]);

      // Logo as data-URI <img> (fixes React crash).
      const LOGO_SVG = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 48'>
        <defs><linearGradient id='g' x1='0' x2='1'><stop offset='0' stop-color='#3b82f6'/><stop offset='0.5' stop-color='#10b981'/><stop offset='1' stop-color='#8b5cf6'/></linearGradient></defs>
        <rect x='0' y='0' width='48' height='48' rx='12' fill='url(#g)'/>
        <path d='M14 30 L24 14 L34 30' fill='none' stroke='white' stroke-width='4' stroke-linecap='round'/>
        <circle cx='24' cy='34' r='4' fill='white'/>
        <text x='58' y='31' font-family='Inter, Arial' font-size='18' font-weight='700' fill='white'>Launch Control</text>
      </svg>`;
      const logoImg = h("img",{src:"data:image/svg+xml;utf8,"+encodeURIComponent(LOGO_SVG),alt:"Launch Control",style:{width:"240px",maxWidth:"100%"}});

      useEffect(()=>{
        const on=()=>setConn(s=>({...s,online:true})); const off=()=>setConn(s=>({...s,online:false}));
        addEventListener("online",on); addEventListener("offline",off);
        return ()=>{ removeEventListener("online",on); removeEventListener("offline",off); };
      },[]);

      // Firebase init + anon auth (guarded)
      useEffect(()=>{
        const fx = async ()=>{
          const f=ensureFirebase();
          if(!f.available){ setConn(s=>({...s,firebase:"no-sdk"})); return; }
          setConn(s=>({...s,firebase:"init"}));
          f.auth.onAuthStateChanged(async u=>{
            if(u){ setUid(u.uid); setConn(s=>({...s,firebase:"authed"}));
              try{
                const snap=await f.db.ref(`users/${u.uid}/projects/default`).get();
                const remote=snap.exists()?snap.val():null;
                if(remote && remote.data){ setData(d=> deepMerge(remote.data,d)); }
                setConn(s=>({...s,firebase:"ok"}));
              }catch(e){ setConn(s=>({...s,firebase:"error"})); setSaveState({status:"error",ts:nowIso(),msg:e.message}); }
            } else {
              try{ await f.auth.signInAnonymously(); }catch(e){ setConn(s=>({...s,firebase:"error"})); }
            }
          });
        };
        fx();
      },[]);

      useEffect(()=>{ localStorage.setItem(LS_KEY, JSON.stringify(data)); },[data]);
      useEffect(()=>{ localStorage.setItem(LS_PROFILE, JSON.stringify(profile)); },[profile]);

      const total = useMemo(()=>{
        let sub=0,done=0; for(const d of data.days){ for(const t of d.tasks){ for(const s of t.subtasks){ sub++; if(s.done) done++; } } }
        return {sub,done,pct: sub? Math.round(done*100/sub):0};
      },[data]);

      const requestSave = useMemo(()=> debounce(async (payload)=>{
        if(!uid) return;
        const f=ensureFirebase(); if(!f.available) return;
        setSaveState({status:"saving",ts:nowIso(),msg:""});
        try{ await f.db.ref(dbPath).set({data:payload,profile,updatedAt:nowIso(),v:1});
          setSaveState({status:"saved",ts:nowIso(),msg:""}); setConn(s=>({...s,firebase:"ok"}));
        }catch(e){ setSaveState({status:"error",ts:nowIso(),msg:e.message}); }
      },500),[uid,dbPath,profile]);

      useEffect(()=>{ requestSave(data); },[data,requestSave]);

      function toggleSub(di,ti,si){ const next=deepClone(data); const s=next.days[di].tasks[ti].subtasks[si]; s.done=!s.done; setData(next); }
      function setNote(di,ti,text){ const next=deepClone(data); next.days[di].tasks[ti].note=text; setData(next); }
      function copyText(t){ navigator.clipboard.writeText(t).catch(()=>{}); }
      function exportJson(){ const a=document.createElement("a");
        a.href=URL.createObjectURL(new Blob([JSON.stringify({profile,data},null,2)],{type:"application/json"}));
        a.download="launch-control-export.json"; a.click();
      }
      function importJson(file){ const r=new FileReader(); r.onload=()=>{ try{const pkg=JSON.parse(r.result); if(pkg.profile) setProfile(pkg.profile); if(pkg.data) setData(pkg.data);}catch{alert("Invalid JSON.");} }; r.readAsText(file); }
      async function runDiagnostics(){
        const f=ensureFirebase(); if(!f.available || !uid){ alert("Firebase not ready."); return; }
        const path=`users/${uid}/projects/default/_diag`;
        try{ await f.db.ref(path).set({ping:nowIso()}); const s=await f.db.ref(path).get(); alert(s.exists()?"DB write/read: PASS":"DB write/read: FAIL"); }
        catch(e){ alert("DB error: "+e.message); }
      }
      function resetAll(){ if(confirm("Reset all local + remote data?")){
        setData(deepClone(SEED)); setProfile({}); const f=ensureFirebase(); if(f.available && uid){ f.db.ref(dbPath).remove().catch(()=>{});} } }

      const filtered = useMemo(()=>{
        if(!q.trim()) return data.days;
        const qq=q.toLowerCase();
        return data.days.map(d=>({...d,tasks:d.tasks.filter(t=> t.title.toLowerCase().includes(qq) ||
          (t.desc||"").toLowerCase().includes(qq) || (t.prompts||[]).some(p=>p.toLowerCase().includes(qq)))})).filter(d=>d.tasks.length);
      },[q,data]);

      // UI
      return h(React.Fragment,null,
        h("div",{className:"wrap"},
          h("div",{className:"header"}, logoImg,
            h("div",null, h("div",{className:"title"},"14-Day AI Business — Launch Control"),
              h("div",{className:"subtitle"},"Professional technical checklist • Blue/Green/Purple theme • Firebase sync")
            )
          ),
          h("div",{className:"bar"},
            h("div",{className:`pill ${navigator.onLine?'ok':'err'}`},"Online: ",navigator.onLine?"Yes":"No"),
            h("div",{className:`pill ${["ok","authed"].includes(conn.firebase)?'ok':(conn.firebase==="error"?'err':'warn')}`},
              "Firebase: ",conn.firebase, uid?` • uid:${uid.slice(0,8)}…`:""
            ),
            h("div",{className:`pill ${saveState.status==='saved'?'ok':(saveState.status==='error'?'err':'warn')}`},
              "Save: ",saveState.status, saveState.ts?` • ${new Date(saveState.ts).toLocaleTimeString()}`:""
            ),
            h("div",{className:"actions"},
              h("button",{className:"btn-primary",onClick:exportJson},"Export"),
              h("label",{className:"pill",style:{cursor:"pointer"}},"Import",
                h("input",{type:"file",accept:"application/json",style:{display:"none"},onChange:e=>e.target.files[0]&&importJson(e.target.files[0])})
              ),
              h("button",{onClick:runDiagnostics},"Diagnostics"),
              h("button",{onClick:resetAll,style:{color:"#ffd0d0",borderColor:"rgba(239,68,68,.35)"}},"Reset")
            )
          ),
          h("div",{className:"grid"},
            h("aside",{className:"card sticky"},
              h("div",{className:"h"},"Settings"),
              h("div",{className:"row"},
                h("input",{type:"text",placeholder:"Brand (e.g., FlowForge.AI)",value:profile.brand||"",onChange:e=>setProfile({...profile,brand:e.target.value})}),
                h("input",{type:"text",placeholder:"Niche (e.g., DTC micro-brands)",value:profile.niche||"",onChange:e=>setProfile({...profile,niche:e.target.value})}),
                h("input",{type:"text",placeholder:"Site URL",value:profile.site||"",onChange:e=>setProfile({...profile,site:e.target.value})}),
                h("input",{type:"email",placeholder:"Email",value:profile.email||"",onChange:e=>setProfile({...profile,email:e.target.value})}),
              ),
              h("div",{className:"h",style:{marginTop:12}},"Progress"),
              h("div",{className:"progress",title: total.pct+"%"}, h("span",{style:{width: total.pct+"%"}})),
              h("div",{className:"muted",style:{marginTop:6}},`${total.done}/${total.sub} subtasks • ${total.pct}%`),
              h("div",{className:"h",style:{marginTop:14}},"Search"),
              h("input",{className:"search",placeholder:"Find task or prompt…",value:q,onChange:e=>setQ(e.target.value)}),
              h("div",{className:"h",style:{marginTop:14}},"Realtime DB Rules"),
              h("div",{className:"code"},`{
  "rules": {
    ".read": false,
    ".write": false,
    "users": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    }
  }
}`),
              h("div",{className:"h",style:{marginTop:14}},"Notes"),
              h("div",{className:"alert"},"Anon auth + user-scoped rules keep data isolated. Keep PII minimal (UK GDPR).")
            ),
            h("main",null,
              filtered.map((d,di)=>h("details",{key:d.day,className:"day",open:true},
                h("summary",null, h("span",{className:"k"},d.day),
                  h("div",null, h("div",{className:"task-title"},`Day ${d.day} — ${d.title}`),
                    h("div",{className:"muted"},"Click to expand tasks")
                  )
                ),
                d.tasks.map((t,ti)=>h("div",{key:t.id,className:"task"},
                  h("div",{className:`check ${ (t.subtasks||[]).every(s=>s.done)?'done':'' }`,onClick:()=>{
                    const next=deepClone(data); const all=next.days[di].tasks[ti].subtasks;
                    const setTo = !(all||[]).every(s=>s.done); (all||[]).forEach(s=> s.done=setTo); setData(next);
                  }},"✓"),
                  h("div",{style:{flex:1}},
                    h("div",{className:"task-title"},t.title),
                    h("div",{className:"muted"},t.desc||""),
                    h("div",{className:"row",style:{marginTop:8}},
                      h("span",{className:"badge"},`${(t.subtasks||[]).filter(s=>s.done).length}/${(t.subtasks||[]).length} done`),
                      h("button",{onClick:()=>setOpenTask({di,ti})},"Open"),
                      h("button",{onClick:()=>{ const next=deepClone(data); next.days[di].tasks[ti].subtasks.forEach(s=> s.done=false); setData(next); }},"Clear")
                    ),
                    openTask && openTask.di===di && openTask.ti===ti && h("div",{className:"drawer"},
                      h("div",{className:"list"}, (t.subtasks||[]).map((s,si)=>h("label",{className:"sub",key:s.id},
                        h("input",{type:"checkbox",checked:!!s.done,onChange:()=>toggleSub(di,ti,si)}), h("span",null,s.t)
                      ))),
                      (t.prompts && t.prompts.length>0) && h("div",null,
                        h("div",{className:"h"},"Prompts"),
                        t.prompts.map((p,idx)=>h("div",{key:idx,className:"card"},
                          h("div",{className:"muted"},"Prompt ",idx+1),
                          h("div",{className:"code"}, p
                            .replaceAll("{{brand}}", profile.brand||"your brand")
                            .replaceAll("{{niche}}", profile.niche||"your niche")),
                          h("div",{className:"row"},
                            h("button",{className:"btn-primary",onClick:()=>copyText(
                              p.replaceAll("{{brand}}", profile.brand||"your brand")
                               .replaceAll("{{niche}}", profile.niche||"your niche")
                               .replaceAll("{{url}}", profile.site||"https://")
                            )},"Copy"),
                            h("button",{onClick:()=>open("https://chat.openai.com","_blank")},"Open AI")
                          )
                        ))
                      ),
                      (t.links && t.links.length>0) && h("div",null,
                        h("div",{className:"h"},"Links"),
                        t.links.map((l,i)=>h("div",{className:"link",key:i}, h("span",{className:"badge"},"Link"),
                          h("a",{href:l.url,target:"_blank",rel:"noreferrer"},l.label)))
                      ),
                      h("div",null, h("div",{className:"h"},"Notes"),
                        h("textarea",{value:t.note||"",onChange:e=>setNote(di,ti,e.target.value),placeholder:"Decisions, URLs, status…"})
                      ),
                      h("div",{className:"footer"},"Autosaves to Firebase (when online) and localStorage.")
                    )
                  )
                ))
              ))
            )
          ),
          h("div",{id:"dashboard-spec",className:"footer"},"Dashboard schema: Date | Sessions | Leads | CVR | Checkouts | MRR | Churn | K-factor | List size | UGC | Reviews")
        )
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));

    // Cache-bust helper for GH Pages: reload if ?v missing (optional)
    (function(){ if(!location.search.includes("v=")){ const v=Date.now(); history.replaceState(null,"",location.pathname+"?v="+v); }})();
  </script>
</body>
</html>

