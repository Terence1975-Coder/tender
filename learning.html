<!-- /index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Learning Prototype – Fixed UI</title>
    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 (UMD) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel Standalone so JSX runs in-browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Optional: Framer Motion UMD; fallback if unavailable -->
    <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>

    <style>
      :root {
        --accent: #6366f1; /* default indigo */
      }
      .bg-accent { background: var(--accent); }
      .text-accent { color: var(--accent); }
      .border-soft { border-color: rgba(0, 0, 0, 0.08); }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-900">
    <div id="root"></div>

    <script type="text/babel">
      // Minimal framer-motion fallback if CDN isn't available.
      const motion = (window.framerMotion && window.framerMotion.motion) || {
        div: (props) => <div {...props} />,
      };

      const { useEffect, useMemo, useState } = React;

      /** ---------------------------
       * Sample Data
       * --------------------------- */
      const WEEKS = [
        {
          id: "w1",
          title: "Week 1 – Foundations",
          sessions: [
            { id: "w1s1", title: "Intro to JS" },
            { id: "w1s2", title: "ES6 Essentials" },
            { id: "w1s3", title: "Debugging Basics" },
          ],
        },
        {
          id: "w2",
          title: "Week 2 – Frontend",
          sessions: [
            { id: "w2s1", title: "React Components" },
            { id: "w2s2", title: "State & Props" },
            { id: "w2s3", title: "Hooks Primer" },
          ],
        },
        {
          id: "w3",
          title: "Week 3 – Tooling",
          sessions: [
            { id: "w3s1", title: "Vite & Bundling" },
            { id: "w3s2", title: "Testing 101" },
            { id: "w3s3", title: "Ship It" },
          ],
        },
      ];

      /** ---------------------------
       * Utils
       * --------------------------- */
      const cls = (...names) => names.filter(Boolean).join(" ");

      /** ---------------------------
       * Whiteboard (stub)
       * --------------------------- */
      function Whiteboard({ notes, setNotes, theme }) {
        const [val, setVal] = useState("");

        const add = () => {
          if (!val.trim()) return;
          setNotes((n) => [...n, val.trim()]);
          setVal("");
        };

        const remove = (i) =>
          setNotes((n) => n.filter((_, idx) => idx !== i));

        return (
          <div className="space-y-3">
            <div className="flex gap-2">
              <input
                value={val}
                onChange={(e) => setVal(e.target.value)}
                placeholder="Add a note…"
                className="flex-1 rounded-xl border border-soft px-3 py-2 outline-none focus:ring-2"
                style={{ caretColor: theme.primary }}
              />
              <button
                onClick={add}
                className="rounded-xl px-4 py-2 text-white bg-accent"
                title="Add note"
              >
                Add
              </button>
            </div>
            <ul className="grid gap-2">
              {notes.length === 0 && (
                <li className="text-xs opacity-60">
                  No notes yet. Jot something above.
                </li>
              )}
              {notes.map((n, i) => (
                <li
                  key={i}
                  className="rounded-xl border border-soft p-3 flex items-start justify-between bg-white"
                >
                  <span className="text-sm">{n}</span>
                  <button
                    onClick={() => remove(i)}
                    className="text-xs underline opacity-70"
                    title="Remove note"
                  >
                    remove
                  </button>
                </li>
              ))}
            </ul>
          </div>
        );
      }

      /** ---------------------------
       * ChatGPTPanel (stub)
       * --------------------------- */
      function ChatGPTPanel({ apiKey, setApiKey, thread, setThread }) {
        const [input, setInput] = useState("");

        const send = () => {
          const msg = input.trim();
          if (!msg) return;
          setThread((t) => [...t, { role: "user", content: msg }]);
          // No network calls; simple echo to demonstrate UI flow.
          setTimeout(() => {
            setThread((t) => [
              ...t,
              { role: "assistant", content: `Echo: ${msg}` },
            ]);
          }, 200);
          setInput("");
        };

        return (
          <div className="rounded-2xl p-4 border border-soft bg-white h-full">
            <div className="font-semibold mb-2">ChatGPT Panel (demo)</div>
            <div className="mb-3">
              <label className="text-xs block mb-1 opacity-70">API Key</label>
              <input
                type="password"
                value={apiKey}
                onChange={(e) => setApiKey(e.target.value)}
                placeholder="sk-… (not used in demo)"
                className="w-full rounded-xl border border-soft px-3 py-2"
              />
            </div>
            <div className="h-40 overflow-auto rounded-xl border border-soft p-2 mb-3 bg-gray-50">
              {thread.length === 0 && (
                <div className="text-xs opacity-60">
                  Start the conversation below.
                </div>
              )}
              {thread.map((m, i) => (
                <div key={i} className="mb-2">
                  <span className="text-[10px] uppercase opacity-50 mr-2">
                    {m.role}
                  </span>
                  <span className="text-sm">{m.content}</span>
                </div>
              ))}
            </div>
            <div className="flex gap-2">
              <input
                value={input}
                onChange={(e) => setInput(e.target.value)}
                onKeyDown={(e) => e.key === "Enter" && send()}
                placeholder="Type a message…"
                className="flex-1 rounded-xl border border-soft px-3 py-2"
              />
              <button onClick={send} className="rounded-xl px-4 py-2 bg-accent text-white">
                Send
              </button>
            </div>
          </div>
        );
      }

      /** ---------------------------
       * Quiz Modal (stub)
       * --------------------------- */
      function Quiz({ s, onClose, onComplete }) {
        const [answer, setAnswer] = useState("");

        const submit = () => {
          // Simple correctness check.
          const ok = answer.trim().toLowerCase().includes(s.title.toLowerCase().split(" ")[0]);
          onComplete?.(ok);
          onClose?.();
        };

        return (
          <div className="fixed inset-0 bg-black/40 flex items-center justify-center z-50">
            <div className="w-full max-w-md rounded-2xl bg-white p-6 shadow-xl">
              <div className="font-semibold text-lg mb-1">Quick Quiz</div>
              <div className="text-sm opacity-70 mb-4">
                Session: <span className="font-medium">{s.title}</span>
              </div>
              <div className="text-sm mb-3">What is a key concept from this session?</div>
              <input
                value={answer}
                onChange={(e) => setAnswer(e.target.value)}
                className="w-full rounded-xl border border-soft px-3 py-2 mb-4"
                placeholder="Type your answer…"
              />
              <div className="flex justify-end gap-2">
                <button onClick={onClose} className="px-3 py-2 rounded-xl border border-soft">
                  Cancel
                </button>
                <button onClick={submit} className="px-4 py-2 rounded-xl bg-accent text-white">
                  Submit
                </button>
              </div>
            </div>
          </div>
        );
      }

      /** ---------------------------
       * Main App
       * --------------------------- */
      function App() {
        const [theme, setTheme] = useState({ primary: "#6366f1" });
        const [notes, setNotes] = useState([]);
        const [apiKey, setApiKey] = useState("");
        const [thread, setThread] = useState([]);
        const [path, setPath] = useState([]);
        const [quizSession, setQuizSession] = useState(null);

        useEffect(() => {
          // Keep CSS var in sync with theme.
          document.documentElement.style.setProperty("--accent", theme.primary);
        }, [theme]);

        const addToPath = (s) =>
          setPath((p) => (p.some((x) => x.id === s.id) ? p : [...p, s]));

        const removeFromPath = (id) =>
          setPath((p) => p.filter((x) => x.id !== id));

        const clearPath = () => setPath([]);

        const allSessions = useMemo(
          () => WEEKS.flatMap((w) => w.sessions),
          []
        );

        return (
          <div className="max-w-6xl mx-auto p-6">
            {/* Header */}
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-3">
                <div className="w-9 h-9 rounded-2xl bg-accent" />
                <div>
                  <div className="font-semibold">Interactive Learning Prototype</div>
                  <div className="text-xs opacity-60">Blue Screen IT Ltd</div>
                </div>
              </div>
              <div className="flex items-center gap-2">
                <input
                  type="color"
                  value={theme.primary}
                  onChange={(e) => setTheme({ primary: e.target.value })}
                  className="w-10 h-10 p-0 rounded-xl border border-soft"
                  title="Change accent colour"
                />
                <span className="text-xs opacity-70">Accent</span>
              </div>
            </div>

            {/* Content Grid */}
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
              {/* Weeks & Sessions */}
              <motion.div
                layout
                className="rounded-2xl border border-soft bg-white p-4 lg:col-span-2"
              >
                <div className="font-semibold mb-3">Course Weeks</div>

                <div className="space-y-4">
                  {WEEKS.map((w) => (
                    <motion.div key={w.id} layout className="rounded-xl border border-soft">
                      <div className="px-4 py-2 bg-gray-50 rounded-t-xl font-medium">
                        {w.title}
                      </div>
                      <ul className="p-3 space-y-2">
                        {w.sessions.map((s) => (
                          <li
                            key={s.id}
                            className="flex items-center justify-between rounded-lg border border-soft p-2"
                          >
                            <span className="text-sm">{s.title}</span>
                            <div className="flex items-center gap-3">
                              <button
                                className="text-xs underline"
                                onClick={() => addToPath(s)}
                                title="Add to path"
                              >
                                add
                              </button>
                              <button
                                className="text-xs underline"
                                onClick={() => setQuizSession(s)}
                                title="Start quiz for this session"
                              >
                                quiz
                              </button>
                            </div>
                          </li>
                        ))}
                      </ul>
                    </motion.div>
                  ))}
                </div>
              </motion.div>

              {/* Learning Path */}
              <motion.div
                layout
                className="rounded-2xl border border-soft bg-white p-4"
              >
                <div className="flex items-center justify-between mb-2">
                  <div className="font-semibold">Your Path</div>
                  <button
                    onClick={clearPath}
                    className="text-xs underline opacity-70"
                    disabled={path.length === 0}
                    title="Clear path"
                  >
                    clear
                  </button>
                </div>

                {path.length === 0 ? (
                  <div className="text-xs opacity-60">
                    No sessions yet. Click <em>add</em> on a session.
                  </div>
                ) : (
                  <ul className="space-y-2">
                    {path.map((s) => (
                      <li
                        key={s.id}
                        className="flex items-center justify-between rounded-lg border border-soft p-2"
                      >
                        <span className="text-sm">{s.title}</span>
                        <button
                          className="text-xs underline opacity-70"
                          onClick={() => removeFromPath(s.id)}
                          title="Remove"
                        >
                          remove
                        </button>
                      </li>
                    ))}
                  </ul>
                )}
              </motion.div>
            </div>

            {/* Tools Row */}
            <div className="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-3">
              <div className="rounded-2xl p-4 border border-soft bg-white">
                <div className="font-semibold mb-2">Floating Whiteboard</div>
                <Whiteboard notes={notes} setNotes={setNotes} theme={theme} />
              </div>

              <ChatGPTPanel
                apiKey={apiKey}
                setApiKey={setApiKey}
                thread={thread}
                setThread={setThread}
              />
            </div>

            {/* Footer */}
            <div className="mt-8 text-xs opacity-70 text-center">
              © 2025 Blue Screen IT Ltd. Course mapping used for interactive learning prototype.
            </div>

            {/* Quiz Modal */}
            {quizSession && (
              <Quiz
                s={quizSession}
                onClose={() => setQuizSession(null)}
                onComplete={(ok) => {
                  // why: mimic your "micro-adaptation" behavior to keep UX intact
                  if (ok) {
                    const all = WEEKS.flatMap((w) => w.sessions);
                    const idx = all.findIndex((x) => x.id === quizSession.id);
                    const next = all[idx + 1];
                    if (next) setPath((p) => (p.some((x) => x.id === next.id) ? p : [...p, next]));
                  }
                }}
              />
            )}
          </div>
        );
      }

      // Mount
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>

