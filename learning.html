diff --git a/learning.html b/learning.html
index 333c44386a0e8676563a4226c8daa61979f62f23..8cc6bae0ae500a52b4af74becb7e4955b54cc23e 100644
--- a/learning.html
+++ b/learning.html
@@ -1,70 +1,71 @@
-import React, { useEffect, useMemo, useRef, useState } from "react";
+import React, { useEffect, useMemo, useState } from "react";
 import { motion, AnimatePresence } from "framer-motion";
 import { v4 as uuidv4 } from "uuid";
-import { initializeApp } from "firebase/app";
-import { getDatabase, ref, set, get, update } from "firebase/database";
+import { initializeApp, getApps } from "firebase/app";
+import { getDatabase, ref, update } from "firebase/database";
 
 /**
  * SupaChargeAI — Interactive AI Training Tool
  * Single-file React app you can upload to GitHub.
  * - 3 learner levels (Novice, Intermediate, Expert)
  * - Learn by Topic or by Challenge/Opportunity
  * - Short/Medium/Long tasks per topic
  * - MCQ quizzes with explanations
  * - Network layout that grows as the learner selects nodes
  * - Theme switcher (base: soft vibrant orange #ff8a3d)
  * - Local persistence + Firebase Realtime DB integration
  * - Floating whiteboard (sticky notes, draggable)
  * - ChatGPT panel (user-supplied API key) for research/creation
  * - Help buttons on topics for extra explanations
  *
  * Notes:
  * - This is framework-agnostic React; you can render <App /> as the root in your project.
  * - Tailwind classes are used for styling. For vanilla CSS envs, replace className with inline styles.
  */
 
 /*******************************
  * Firebase (Provided Config)
  *******************************/
 const firebaseConfig = {
   apiKey: "AIzaSyChiAlrD-JLtBSDN3sOyxYiLGig-6Cy3GM",
   authDomain: "prospecting-f2f42.firebaseapp.com",
   databaseURL: "https://prospecting-f2f42-default-rtdb.europe-west1.firebasedatabase.app",
   projectId: "prospecting-f2f42",
   storageBucket: "prospecting-f2f42.firebasestorage.app",
   messagingSenderId: "292034226428",
   appId: "1:292034226428:web:878b867e3eb4d3e0098f79",
   measurementId: "G-WWB0JTX2L2",
 };
 let appInstance;
 try {
-  appInstance = initializeApp(firebaseConfig);
+  const apps = getApps();
+  appInstance = apps.length ? apps[0] : initializeApp(firebaseConfig);
 } catch (e) {
-  // ignore duplicate init in dev HMR
+  console.warn("Firebase init skipped", e);
 }
-const db = getDatabase();
+const db = appInstance ? getDatabase(appInstance) : null;
 
 /*******************************
  * Data — Course Structure
  *******************************/
 const WEEKS = [
   {
     id: "w1_2",
     title: "Week 1-2: AI Fundamentals for Business",
     sessions: [
       {
         id: "s1_intro_ai",
         title: "Session 1: Introduction to AI in the Workplace",
         level: "Novice",
         summary:
           "Demystify AI for non-technical professionals; understand evolution and current role in business.",
         help:
           "AI spans rule-based automation through modern machine learning and generative models. Focus on value, not buzzwords.",
         tasks: {
           short: ["List 5 AI touchpoints in your daily work."],
           medium: [
             "Interview a colleague about AI friction points; summarize 3 opportunities.",
           ],
           long: [
             "Draft a 1-page memo on where AI could support your team with risks/benefits.",
           ],
diff --git a/learning.html b/learning.html
index 333c44386a0e8676563a4226c8daa61979f62f23..8cc6bae0ae500a52b4af74becb7e4955b54cc23e 100644
--- a/learning.html
+++ b/learning.html
@@ -468,83 +469,109 @@ const CHALLENGES = [
       "s7_research",
       "s8_predictive",
       "s15_problem_solving",
     ],
     howTo: [
       "Define pain, users, and success metrics.",
       "Choose architecture (chat + tools + RAG if needed).",
       "Prototype fast; evaluate; iterate.",
     ],
   },
   {
     id: "c_data_clarity",
     label: "I need clarity on my data with regards to…",
     mapTo: ["s6_data", "s7_research", "s17_ethics"],
     howTo: [
       "Inventory sources and permissions.",
       "Profile data quality; document assumptions.",
       "Define privacy, retention, and access controls.",
     ],
   },
 ];
 
 /*******************************
  * Utilities
  *******************************/
+const hasWindow = typeof window !== "undefined";
+
 const useLocalId = () => {
   const [id, setId] = useState("");
   useEffect(() => {
-    let stored = localStorage.getItem("scai_local_id");
+    if (!hasWindow) return;
+    let stored = window.localStorage.getItem("scai_local_id");
     if (!stored) {
       stored = uuidv4();
-      localStorage.setItem("scai_local_id", stored);
+      try {
+        window.localStorage.setItem("scai_local_id", stored);
+      } catch {}
     }
     setId(stored);
   }, []);
   return id;
 };
 
 const persist = async (userId, key, value) => {
-  try {
-    localStorage.setItem(key, JSON.stringify(value));
-  } catch {}
+  if (hasWindow) {
+    try {
+      window.localStorage.setItem(key, JSON.stringify(value));
+    } catch {}
+  }
+  if (!db || !userId) return;
   try {
     await update(ref(db, `users/${userId}`), { [key]: value });
   } catch (e) {
     console.warn("Firebase update skipped or failed", e);
   }
 };
 
 const loadLocal = (key, fallback) => {
+  if (!hasWindow) return fallback;
   try {
-    const s = localStorage.getItem(key);
+    const s = window.localStorage.getItem(key);
     return s ? JSON.parse(s) : fallback;
   } catch {
     return fallback;
   }
 };
 
+const loadLocalString = (key, fallback = "") => {
+  if (!hasWindow) return fallback;
+  try {
+    const value = window.localStorage.getItem(key);
+    return value !== null ? value : fallback;
+  } catch {
+    return fallback;
+  }
+};
+
+const saveLocalString = (key, value) => {
+  if (!hasWindow) return;
+  try {
+    window.localStorage.setItem(key, value);
+  } catch {}
+};
+
 /*******************************
  * UI Helpers
  *******************************/
 const Pill = ({ children }) => (
   <span className="px-2 py-0.5 rounded-full bg-black/10 dark:bg-white/10 text-xs">
     {children}
   </span>
 );
 
 const HelpButton = ({ text }) => {
   const [open, setOpen] = useState(false);
   return (
     <div className="relative inline-block">
       <button
         onClick={() => setOpen((v) => !v)}
         className="ml-2 inline-flex items-center justify-center w-6 h-6 rounded-full bg-white border border-black/10 shadow text-xs hover:scale-105"
         title="Need a quick explainer?"
       >
         ?
       </button>
       <AnimatePresence>
         {open && (
           <motion.div
             initial={{ opacity: 0, y: 4 }}
             animate={{ opacity: 1, y: 0 }}
diff --git a/learning.html b/learning.html
index 333c44386a0e8676563a4226c8daa61979f62f23..8cc6bae0ae500a52b4af74becb7e4955b54cc23e 100644
--- a/learning.html
+++ b/learning.html
@@ -806,114 +833,120 @@ const ChatGPTPanel = ({ apiKey, setApiKey, thread, setThread }) => {
           temperature: 0.3,
         }),
       });
       const data = await res.json();
       const reply = data?.choices?.[0]?.message?.content || "(no response)";
       setThread((prev) => [...prev, { role: "assistant", content: reply }]);
     } catch (e) {
       setThread((prev) => [
         ...prev,
         { role: "assistant", content: "Error calling OpenAI API. Check key/network." },
       ]);
     } finally {
       setBusy(false);
     }
   };
 
   return (
     <div className="rounded-2xl border bg-white p-4 space-y-3">
       <div className="font-semibold">Research & Creation (ChatGPT)</div>
       <input
         className="w-full border rounded-xl px-3 py-2 text-sm"
         placeholder="Paste your OpenAI API key (stored locally)"
         value={apiKey}
         onChange={(e) => {
           setApiKey(e.target.value);
-          localStorage.setItem("scai_openai_key", e.target.value);
+          saveLocalString("scai_openai_key", e.target.value);
         }}
       />
       <div className="h-40 overflow-auto border rounded-xl p-2 bg-gray-50">
         {thread.map((m, i) => (
           <div key={i} className="text-sm mb-2">
             <span className={`font-semibold ${m.role === "user" ? "text-gray-700" : "text-blue-700"}`}>
               {m.role === "user" ? "You" : "Assistant"}:
             </span>{" "}
             <span>{m.content}</span>
           </div>
         ))}
       </div>
       <div className="flex gap-2">
         <input
           className="flex-1 border rounded-xl px-3 py-2 text-sm"
           placeholder="Ask for research, drafting, prompts…"
           value={input}
           onChange={(e) => setInput(e.target.value)}
         />
         <button onClick={chat} disabled={busy} className="px-3 py-2 rounded-xl border bg-black text-white text-sm">
           {busy ? "Thinking…" : "Send"}
         </button>
       </div>
       <div className="text-xs opacity-70">Your key is stored only in your browser and used client-side.</div>
     </div>
   );
 };
 
 /*******************************
  * Main App
  *******************************/
 export default function App() {
   const userId = useLocalId();
   const [theme, setTheme] = useState(
     loadLocal("scai_theme", { name: "Sunburst", primary: "#ff8a3d", bg: "#fff8f3", text: "#111827" })
   );
   const [level, setLevel] = useState(loadLocal("scai_level", "Novice"));
   const [path, setPath] = useState(loadLocal("scai_path", "By Topic"));
   const [selectedWeek, setSelectedWeek] = useState(WEEKS[0].id);
   const [learningPath, setLearningPath] = useState(loadLocal("scai_learning_path", []));
   const [notes, setNotes] = useState(loadLocal("scai_notes", []));
-  const [apiKey, setApiKey] = useState(localStorage.getItem("scai_openai_key") || "");
+  const [apiKey, setApiKey] = useState(() => loadLocalString("scai_openai_key", ""));
   const [thread, setThread] = useState(loadLocal("scai_thread", []));
   const [quizSession, setQuizSession] = useState(null);
 
   useEffect(() => {
+    if (!userId) return;
     persist(userId, "scai_theme", theme);
-  }, [theme]);
+  }, [userId, theme]);
   useEffect(() => {
+    if (!userId) return;
     persist(userId, "scai_level", level);
-  }, [level]);
+  }, [userId, level]);
   useEffect(() => {
+    if (!userId) return;
     persist(userId, "scai_path", path);
-  }, [path]);
+  }, [userId, path]);
   useEffect(() => {
+    if (!userId) return;
     persist(userId, "scai_learning_path", learningPath);
-  }, [learningPath]);
+  }, [userId, learningPath]);
   useEffect(() => {
+    if (!userId) return;
     persist(userId, "scai_notes", notes);
-  }, [notes]);
+  }, [userId, notes]);
   useEffect(() => {
+    if (!userId) return;
     persist(userId, "scai_thread", thread);
-  }, [thread]);
+  }, [userId, thread]);
 
   const currentWeek = useMemo(() => WEEKS.find((w) => w.id === selectedWeek) || WEEKS[0], [selectedWeek]);
   const availableNodes = useMemo(() => {
     if (path === "By Topic") return currentWeek.sessions;
     // By Challenge
     return CHALLENGES.map((c) => ({ id: c.id, title: c.label }));
   }, [path, selectedWeek]);
 
   const addToPath = (item) => {
     if (learningPath.find((x) => x.id === item.id)) return;
     setLearningPath((prev) => [...prev, { id: item.id, title: item.title }]);
   };
 
   const onNetworkSelect = (n) => {
     if (path === "By Topic") {
       const s = currentWeek.sessions.find((x) => x.id === n.id);
       if (s) addToPath(s);
     } else {
       // challenge selected -> expand mapped sessions into path
       const c = CHALLENGES.find((x) => x.id === n.id);
       if (!c) return;
       const sessions = WEEKS.flatMap((w) => w.sessions).filter((s) => c.mapTo.includes(s.id));
       const toAdd = sessions.filter((s) => !learningPath.some((lp) => lp.id === s.id));
       setLearningPath((prev) => [...prev, ...toAdd.map((s) => ({ id: s.id, title: s.title }))]);
     }

