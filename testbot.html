<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ AI Bootcamp Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        /* Professional Training Company Theme */
        .main-bg { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #06b6d4 100%); }
        .card-bg { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .accent-blue { background: #2563eb; }
        .accent-cyan { background: #06b6d4; }
        .accent-purple { background: #7c3aed; }
        .text-brand { color: #1e40af; }
        
        .tab-active { 
            border-bottom: 3px solid #2563eb; 
            color: #2563eb; 
            background: rgba(37, 99, 235, 0.1);
            border-radius: 8px 8px 0 0;
        }
        .tab-inactive { 
            border-bottom: 3px solid transparent; 
            color: #64748b; 
            transition: all 0.3s ease;
        }
        .tab-inactive:hover { 
            color: #1e40af; 
            background: rgba(37, 99, 235, 0.05);
            border-radius: 8px 8px 0 0;
        }
        
        .modal { display: none !important; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: -1; visibility: hidden; opacity: 0; }
        .modal.show { display: none !important; visibility: hidden; opacity: 0; }
        
        .btn { 
            display: inline-flex; 
            align-items: center; 
            gap: 0.5rem; 
            padding: 0.75rem 1.25rem; 
            border-radius: 0.5rem; 
            font-weight: 600; 
            transition: all 0.3s ease; 
            cursor: pointer; 
            border: none; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        
        .btn-green { background: linear-gradient(45deg, #10b981, #059669); color: white; }
        .btn-blue { background: linear-gradient(45deg, #2563eb, #1d4ed8); color: white; }
        .btn-cyan { background: linear-gradient(45deg, #06b6d4, #0891b2); color: white; }
        .btn-purple { background: linear-gradient(45deg, #7c3aed, #6d28d9); color: white; }
        .btn-yellow { background: linear-gradient(45deg, #f59e0b, #d97706); color: white; }
        .btn-red { background: linear-gradient(45deg, #ef4444, #dc2626); color: white; }
        .btn-gray { background: linear-gradient(45deg, #f8fafc, #e2e8f0); color: #374151; border: 1px solid #d1d5db; }
        
        .card { 
            background: rgba(255, 255, 255, 0.95); 
            border-radius: 1rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); 
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .card:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); 
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            background: linear-gradient(135deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0.95) 100%);
            transform: translateY(-4px);
        }
        
        .firebase-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 25px;
            color: white;
            font-size: 0.9em;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        .firebase-connected { 
            background: linear-gradient(45deg, #10b981, #059669); 
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); 
        }
        .firebase-disconnected { 
            background: linear-gradient(45deg, #ef4444, #dc2626); 
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4); 
        }
        .firebase-saving { 
            background: linear-gradient(45deg, #f59e0b, #d97706); 
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4); 
        }
        
        .copy-btn {
            background: linear-gradient(45deg, #06b6d4, #0891b2);
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 0.5rem;
        }
        .copy-btn:hover {
            background: linear-gradient(45deg, #0891b2, #0e7490);
            transform: scale(1.05);
        }
        
        .applicant-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .applicant-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2563eb, #06b6d4, #10b981);
        }
        .applicant-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .status-passed { background: linear-gradient(45deg, #10b981, #059669); color: white; }
        .status-failed { background: linear-gradient(45deg, #ef4444, #dc2626); color: white; }
        .status-waitlist { background: linear-gradient(45deg, #f59e0b, #d97706); color: white; }
        .status-processed { background: linear-gradient(45deg, #7c3aed, #6d28d9); color: white; }
        
        .score-badge {
            background: linear-gradient(45deg, #1e40af, #2563eb);
            color: white;
            padding: 0.75rem;
            border-radius: 50%;
            font-weight: 700;
            font-size: 1.25rem;
            min-width: 4rem;
            height: 4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }
        
        .header-gradient {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 50%, #06b6d4 100%);
            color: white;
        }
        
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            max-width: 400px;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            color: white;
            font-weight: 500;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        .notification.show { transform: translateX(0); }
        .notification.success { background: linear-gradient(45deg, #10b981, #059669); }
        .notification.error { background: linear-gradient(45deg, #ef4444, #dc2626); }
        .notification.info { background: linear-gradient(45deg, #2563eb, #1d4ed8); }
    </style>
</head>
<body class="min-h-screen main-bg">
    <!-- Firebase Status Indicator -->
    <div id="firebase-status" class="firebase-status firebase-disconnected">
        üî¥ Firebase Disconnected
    </div>

    <!-- Header -->
    <div class="header-gradient shadow-xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-8">
                <div>
                    <h1 class="text-4xl font-bold text-white mb-2">ü§ñ AI Bootcamp Dashboard</h1>
                    <p class="text-blue-100 text-lg">Manage screening applications and chatbots</p>
                    <p class="text-sm text-cyan-200 mt-2">üîó Connected to: https://terence1975-coder.github.io/tender/bot.html</p>
                    <div id="connection-status" class="mt-3"></div>
                </div>
                <div class="flex flex-col space-y-3">
                    <div class="flex space-x-3">
                        <button onclick="showCSVData()" class="btn btn-green text-sm">üì• Show Excel Data</button>
                        <button onclick="testBotIntegration()" class="btn btn-cyan text-sm">üîó Test Bot Connection</button>
                        <button onclick="debugBotConnection()" class="btn btn-red text-sm">üîß Debug Bot</button>
                        <button onclick="testRealBotData()" class="btn btn-purple text-sm">üéØ Test Real Bot Data</button>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="saveToFirebase()" class="btn btn-blue text-sm">‚òÅÔ∏è Save to Cloud</button>
                        <button onclick="loadFromFirebase()" class="btn btn-gray text-sm">üì• Load from Cloud</button>
                        <button onclick="testFirebase()" class="btn btn-yellow text-sm">üß™ Test Firebase</button>
                        <button onclick="resetToTestData()" class="btn btn-gray text-sm">üîÑ Reset Demo</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="border-b border-white/20 bg-white/10 rounded-t-xl mt-6">
            <nav class="flex space-x-0">
                <button onclick="switchTab('overview')" id="tab-overview" class="tab-active py-4 px-6 font-semibold text-sm">üìä Overview</button>
                <button onclick="switchTab('applicants')" id="tab-applicants" class="tab-inactive py-4 px-6 font-semibold text-sm">üë• Applicant Reports</button>
                <button onclick="switchTab('chatbots')" id="tab-chatbots" class="tab-inactive py-4 px-6 font-semibold text-sm">‚öôÔ∏è Manage Chatbots</button>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-8">
        <!-- Overview Tab -->
        <div id="content-overview" class="space-y-8 bg-white/10 rounded-b-xl rounded-tr-xl p-6">
            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                <div class="stat-card card p-6">
                    <div class="flex items-center">
                        <div class="text-4xl">üë•</div>
                        <div class="ml-4">
                            <p class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Total Applicants</p>
                            <p class="text-3xl font-bold text-brand" id="stat-total">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card card p-6">
                    <div class="flex items-center">
                        <div class="text-4xl">‚úÖ</div>
                        <div class="ml-4">
                            <p class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Passed</p>
                            <p class="text-3xl font-bold text-green-600" id="stat-passed">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card card p-6">
                    <div class="flex items-center">
                        <div class="text-4xl">‚ùå</div>
                        <div class="ml-4">
                            <p class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Failed</p>
                            <p class="text-3xl font-bold text-red-600" id="stat-failed">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card card p-6">
                    <div class="flex items-center">
                        <div class="text-4xl">‚è≥</div>
                        <div class="ml-4">
                            <p class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Waitlist</p>
                            <p class="text-3xl font-bold text-yellow-600" id="stat-waitlist">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card card p-6">
                    <div class="flex items-center">
                        <div class="text-4xl">‚úîÔ∏è</div>
                        <div class="ml-4">
                            <p class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Processed</p>
                            <p class="text-3xl font-bold text-purple-600" id="stat-processed">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <div class="px-8 py-6 border-b border-gray-200">
                    <h3 class="text-xl font-bold text-brand">üìù Recent Applications</h3>
                    <p class="text-gray-600 mt-1">Latest candidate submissions from your bot</p>
                </div>
                <div class="divide-y divide-gray-100" id="recent-applicants"></div>
            </div>

            <!-- BroadcastChannel Debug Output -->
            <div class="card">
                <div class="px-8 py-6 border-b border-gray-200">
                    <h3 class="text-xl font-bold text-brand">üîó Bot Communication Channel</h3>
                    <p class="text-gray-600 mt-1">Real-time data from bot.html via BroadcastChannel</p>
                </div>
                <div class="p-8">
                    <pre id="output" class="bg-gradient-to-r from-gray-50 to-blue-50 p-6 rounded-xl text-sm overflow-auto max-h-64 border border-blue-200">Waiting for data from bot.html...</pre>
                    <div class="mt-6 flex space-x-3">
                        <button onclick="testBroadcastChannel()" class="btn btn-blue text-sm">üì° Test Broadcast</button>
                        <button onclick="testRealBotDataBroadcast()" class="btn btn-green text-sm">üéØ Test Real Bot Data</button>
                        <button onclick="clearOutput()" class="btn btn-gray text-sm">üóëÔ∏è Clear Output</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Applicants Tab -->
        <div id="content-applicants" class="space-y-8 bg-white/10 rounded-b-xl rounded-tr-xl p-6" style="display: none;">
            <!-- Passed Applicants -->
            <div class="card overflow-hidden">
                <div class="bg-gradient-to-r from-green-500 to-emerald-600 px-8 py-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-2xl font-bold">‚úÖ Passed Applicants</h3>
                            <p class="text-green-100 mt-1">High-performing candidates ready for acceptance</p>
                            <span class="text-3xl font-bold" id="passed-count">0</span>
                        </div>
                        <button onclick="showCategoryData('passed')" class="btn btn-gray text-green-700 hover:text-green-900">üì• Export Data</button>
                    </div>
                </div>
                <div class="p-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="passed-applicants"></div>
                </div>
            </div>

            <!-- Waitlist Applicants -->
            <div class="card overflow-hidden">
                <div class="bg-gradient-to-r from-yellow-500 to-orange-500 px-8 py-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-2xl font-bold">‚è≥ Waitlist Applicants</h3>
                            <p class="text-yellow-100 mt-1">Potential candidates for review</p>
                            <span class="text-3xl font-bold" id="waitlist-count">0</span>
                        </div>
                        <button onclick="showCategoryData('waitlist')" class="btn btn-gray text-yellow-700 hover:text-yellow-900">üì• Export Data</button>
                    </div>
                </div>
                <div class="p-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="waitlist-applicants"></div>
                </div>
            </div>

            <!-- Failed Applicants -->
            <div class="card overflow-hidden">
                <div class="bg-gradient-to-r from-red-500 to-rose-600 px-8 py-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-2xl font-bold">‚ùå Failed Applicants</h3>
                            <p class="text-red-100 mt-1">Candidates requiring further development</p>
                            <span class="text-3xl font-bold" id="failed-count">0</span>
                        </div>
                        <button onclick="showCategoryData('failed')" class="btn btn-gray text-red-700 hover:text-red-900">üì• Export Data</button>
                    </div>
                </div>
                <div class="p-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="failed-applicants"></div>
                </div>
            </div>

            <!-- Processed Applicants -->
            <div class="card overflow-hidden">
                <div class="bg-gradient-to-r from-purple-500 to-indigo-600 px-8 py-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-2xl font-bold">‚úîÔ∏è Processed Applicants</h3>
                            <p class="text-purple-100 mt-1">Completed applications archived</p>
                            <span class="text-3xl font-bold" id="processed-count">0</span>
                        </div>
                        <button onclick="showCategoryData('processed')" class="btn btn-gray text-purple-700 hover:text-purple-900">üì• Export Data</button>
                    </div>
                </div>
                <div class="p-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="processed-applicants"></div>
                </div>
            </div>
        </div>

        <!-- Chatbots Tab -->
        <div id="content-chatbots" class="space-y-8 bg-white/10 rounded-b-xl rounded-tr-xl p-6" style="display: none;">
            <div class="card p-8">
                <h3 class="text-2xl font-bold text-brand mb-6">ü§ñ Create New Screening Chatbot</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">Chatbot Name</label>
                        <input type="text" id="chatbot-name" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" placeholder="Enter chatbot name">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">Course/Bootcamp</label>
                        <select id="chatbot-course" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
                            <option>AI Fundamentals</option>
                            <option>Machine Learning</option>
                            <option>Data Science</option>
                        </select>
                    </div>
                </div>
                <div class="mt-8">
                    <button onclick="createChatbot()" class="btn btn-blue">‚ûï Create Chatbot</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal (Hidden) -->
    <div id="modal" class="modal">
        <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl">
            <div class="flex justify-between items-center p-6 border-b bg-gray-50">
                <h2 id="modal-title" class="text-xl font-semibold text-gray-900">Modal Title</h2>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">‚ùå</button>
            </div>
            <div class="p-6 overflow-auto max-h-[70vh]">
                <textarea id="modal-content" readonly class="w-full h-96 p-4 border border-gray-300 rounded-md font-mono text-sm bg-gray-50 resize-none"></textarea>
                <div class="mt-4 flex justify-between items-center">
                    <p class="text-sm text-gray-600">üí° Select all content above (Ctrl+A) and copy (Ctrl+C) to save</p>
                    <button onclick="copyToClipboard()" id="copy-btn" class="btn btn-blue">Copy to Clipboard</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // üî• CORE DATA STRUCTURES
        let applicants = [];
        let botStats = { totalReceived: 0, lastReceived: 'Never', connectionStatus: 'Ready', lastPing: 'Never' };
        let messageLog = [];
        let database = null;
        let firebaseApp = null;

        // Original test data
        const originalTestData = [
            { id: 1, name: 'John Smith', email: 'john@email.com', phone: '+1 (555) 123-4567', date: '2025-01-15', status: 'passed', score: 85, bootcamp: 'AI Fundamentals', responses: ['Correct', 'Correct', 'Incorrect', 'Correct', 'Correct'] },
            { id: 2, name: 'Sarah Johnson', email: 'sarah@email.com', phone: '+1 (555) 234-5678', date: '2025-01-14', status: 'failed', score: 45, bootcamp: 'AI Fundamentals', responses: ['Incorrect', 'Correct', 'Incorrect', 'Incorrect', 'Correct'] },
            { id: 3, name: 'Mike Chen', email: 'mike@email.com', phone: '+1 (555) 345-6789', date: '2025-01-13', status: 'waitlist', score: 65, bootcamp: 'AI Fundamentals', responses: ['Correct', 'Incorrect', 'Correct', 'Correct', 'Incorrect'] },
            { id: 4, name: 'Emily Davis', email: 'emily@email.com', phone: '+1 (555) 456-7890', date: '2025-01-12', status: 'passed', score: 92, bootcamp: 'Machine Learning', responses: ['Correct', 'Correct', 'Correct', 'Correct', 'Incorrect'] }
        ];

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyChiAlrD-JLtBSDN3sOyxYiLGig-6Cy3GM",
            authDomain: "prospecting-f2f42.firebaseapp.com",
            databaseURL: "https://prospecting-f2f42-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "prospecting-f2f42",
            storageBucket: "prospecting-f2f42.firebasestorage.app",
            messagingSenderId: "292034226428",
            appId: "1:292034226428:web:878b867e3eb4d3e0098f79"
        };

        // üîó BROADCASTCHANNEL INTEGRATION - Cross-tab communication
        let botChannel = null;
        
        function initializeBroadcastChannel() {
            try {
                // Create BroadcastChannel for cross-tab communication
                botChannel = new BroadcastChannel('bot_channel');
                
                botChannel.onmessage = (event) => {
                    const data = event.data;
                    console.log('üì° Received from bot.html via BroadcastChannel:', data);
                    
                    // Update debug output
                    const output = document.getElementById('output');
                    if (output) {
                        output.textContent = `üì° RECEIVED: ${new Date().toLocaleTimeString()}\n${JSON.stringify(data, null, 2)}`;
                    }
                    
                    // Process the candidate data
                    if (data && typeof data === 'object') {
                        if (data.messageType === 'CONNECTION_TEST') {
                            showNotification('‚úÖ BroadcastChannel connection test successful!', 'success');
                            return;
                        }
                        
                        // Look for any candidate data - be very permissive
                        const hasName = data.name || data.candidate_name || data.candidateName;
                        const hasEmail = data.email || data.candidate_email;
                        const hasScore = data.score !== undefined || data.assessment_score !== undefined;
                        const hasStatus = data.status || data.assessment_status;
                        
                        if (hasName || hasEmail || hasScore || hasStatus) {
                            console.log('üéØ Processing candidate data from BroadcastChannel');
                            
                            // Enhanced candidate data extraction specifically for BroadcastChannel
                            const candidateData = extractBroadcastChannelData(data);
                            console.log('üîç Extracted candidate data:', candidateData);
                            
                            if (candidateData.name) {
                                addNewApplicant(candidateData);
                                showNotification(`‚úÖ BroadcastChannel: Added ${candidateData.name} to ${candidateData.status} section (${candidateData.score}%)`, 'success', 8000);
                                
                                // Force UI refresh to ensure it appears
                                setTimeout(() => {
                                    refreshUI();
                                    console.log('üîÑ UI refreshed after BroadcastChannel data');
                                }, 500);
                            } else {
                                console.log('‚ö†Ô∏è Could not extract name from candidate data');
                                showNotification('‚ö†Ô∏è Received data but could not extract candidate name', 'error');
                            }
                        } else {
                            console.log('‚ÑπÔ∏è BroadcastChannel message received but no candidate data found');
                            showNotification(`‚ÑπÔ∏è BroadcastChannel: ${JSON.stringify(data)}`, 'info', 3000);
                        }
                    }
                };
                
                console.log('üì° BroadcastChannel initialized successfully');
                showNotification('üì° BroadcastChannel ready for bot communication', 'info', 3000);
                
            } catch (error) {
                console.error('‚ùå BroadcastChannel failed to initialize:', error);
                showNotification('‚ùå BroadcastChannel not supported in this browser', 'error');
            }
        }
        
        function testRealBotDataBroadcast() {
            if (botChannel) {
                console.log('üéØ Testing BroadcastChannel with REAL bot data...');
                
                // Exact data format your bot is likely sending
                const realBotData = {
                    name: 'Terence Edwin Herbert',
                    email: 'terence.herbert75@gmail.com',
                    mobile: '07857553275',
                    phone: '07857553275',
                    score: '10/10',
                    status: 'HIGHLY_SUITABLE',
                    interviewBooked: true,
                    sessionId: '1752709265754',
                    course: 'AI Business Productivity Bootcamp',
                    source: 'BroadcastChannel Test'
                };
                
                console.log('üì° Sending real bot data via BroadcastChannel:', realBotData);
                botChannel.postMessage(realBotData);
                
                showNotification('üéØ Sent real bot data via BroadcastChannel - Check Applicant Reports tab!', 'success', 8000);
                
                // Auto-switch to applicant reports tab after delay
                setTimeout(() => {
                    switchTab('applicants');
                    showNotification('üìç Switched to Applicant Reports - Look for Terence Edwin Herbert in Passed section!', 'info', 5000);
                }, 2000);
            } else {
                showNotification('‚ùå BroadcastChannel not initialized', 'error');
            }
        }

        function testBroadcastChannel() {
            if (botChannel) {
                // Send test message to any listening bots
                const testMessage = { messageType: 'DASHBOARD_TEST', timestamp: new Date().toISOString() };
                botChannel.postMessage(testMessage);
                
                // Also test receiving our own test data
                setTimeout(() => {
                    const testData = {
                        name: 'BroadcastChannel Test',
                        email: 'broadcast@test.com',
                        score: '9/10',
                        status: 'HIGHLY_SUITABLE',
                        source: 'BroadcastChannel Test'
                    };
                    botChannel.postMessage(testData);
                }, 500);
                
                showNotification('üì° BroadcastChannel test sent', 'info');
            } else {
                showNotification('‚ùå BroadcastChannel not initialized', 'error');
            }
        }
        
        function clearOutput() {
            const output = document.getElementById('output');
            if (output) {
                output.textContent = 'Waiting for data from bot.html...';
            }
        }

        // ü§ñ BOT INTEGRATION - Enhanced Message Listener
        window.addEventListener('message', function(event) {
            console.log('üì® Bot message received:', event.origin, event.data);
            messageLog.push({ timestamp: new Date().toISOString(), origin: event.origin, data: event.data });
            
            // Very permissive for debugging - accept from any GitHub Pages origin
            const allowedOrigins = [
                'https://terence1975-coder.github.io',
                'http://localhost', 
                'https://localhost',
                'null' // For file:// protocol
            ];
            const isAllowed = allowedOrigins.some(origin => 
                event.origin.startsWith(origin) || 
                event.origin.includes('github.io') ||
                event.origin === 'null'
            );
            
            if (!isAllowed) {
                console.log('üö´ Origin not whitelisted, processing anyway for debug:', event.origin);
            }
            
            // Log detailed message info for debugging
            console.log('üîç Message details:', {
                origin: event.origin,
                dataType: typeof event.data,
                dataKeys: event.data ? Object.keys(event.data) : [],
                fullData: event.data
            });
            
            // Process any message with candidate data
            if (event.data && typeof event.data === 'object') {
                if (event.data.messageType === 'CONNECTION_TEST') {
                    console.log('‚úÖ Connection test successful');
                    showNotification('‚úÖ Bot connection test successful!', 'success');
                    return;
                }
                
                // Look for candidate data in the message
                const hasName = event.data.name || event.data.candidate_name || event.data.candidateName;
                const hasScore = event.data.score !== undefined || event.data.assessment_score !== undefined;
                const hasStatus = event.data.status || event.data.assessment_status;
                
                if (hasName || hasScore || hasStatus) {
                    console.log('üéØ Processing candidate data from bot');
                    const candidateData = extractCandidateData(event.data);
                    if (candidateData.name) {
                        addNewApplicant(candidateData);
                        showNotification(`‚úÖ New candidate: ${candidateData.name} (${candidateData.status}) - Score: ${candidateData.score}%`, 'success', 8000);
                    }
                } else {
                    console.log('‚ö†Ô∏è Message received but no recognizable candidate data found');
                    showNotification(`‚ÑπÔ∏è Message received from bot but no candidate data found: ${JSON.stringify(event.data)}`, 'info', 5000);
                }
            }
        });

        // Enhanced candidate data extraction specifically for BroadcastChannel
        function extractBroadcastChannelData(data) {
            console.log('üîç Extracting BroadcastChannel candidate data from:', data);
            
            // Extract basic info with multiple fallbacks
            const name = data.name || data.candidate_name || data.candidateName || 
                        data.candidateDetails?.name || '';
            
            const email = data.email || data.candidate_email || data.candidateEmail || 
                         data.candidateDetails?.email || 
                         (name ? `${name.toLowerCase().replace(/\s+/g, '.')}@example.com` : '');
            
            const phone = data.phone || data.mobile || data.candidate_phone || 
                         data.candidatePhone || data.candidateDetails?.phone || '+44 0000 000000';
            
            // Handle score extraction with multiple formats
            let score = 0;
            let mappedScore = 0;
            let status = 'failed';
            
            // Handle different score formats
            if (data.score !== undefined) {
                if (typeof data.score === 'string' && data.score.includes('/')) {
                    // Handle "10/10" format
                    const parts = data.score.split('/');
                    const numerator = parseInt(parts[0]);
                    const denominator = parseInt(parts[1]);
                    score = (numerator / denominator) * 100;
                } else {
                    score = parseInt(data.score);
                }
            } else if (data.assessment_score !== undefined) {
                score = parseInt(data.assessment_score);
            } else if (data.finalScore !== undefined) {
                score = parseInt(data.finalScore);
            }
            
            // Map bot status to dashboard status and score
            if (data.status === 'HIGHLY_SUITABLE' || (score >= 90 && score <= 100)) {
                mappedScore = Math.max(score, 90);
                status = 'passed';
            } else if (data.status === 'SUITABLE' || (score >= 70 && score < 90)) {
                mappedScore = Math.max(score, 70);
                status = 'waitlist';
            } else if (data.status === 'NOT_SUITABLE' || score < 70) {
                mappedScore = Math.min(score, 60);
                status = 'failed';
            } else {
                // Default mapping based on score
                mappedScore = score > 10 ? score : score * 10; // Convert if needed
                status = mappedScore >= 80 ? 'passed' : mappedScore >= 60 ? 'waitlist' : 'failed';
            }
            
            const result = {
                name,
                email,
                phone,
                score: mappedScore,
                status,
                bootcamp: data.course || data.bootcamp || data.program || 'AI Business Productivity Bootcamp',
                responses: data.responses || data.answers || data.assessment_answers || ['BroadcastChannel', 'Assessment', 'Completed'],
                location: data.location || 'Not specified',
                employmentStatus: data.employmentStatus || data.employment || 'Not specified',
                ukResidency: data.ukResidency || data.uk_residency || 'Not specified',
                interviewBooked: data.interviewBooked || data.interview_booked || data.interviewConfirmed || false,
                sessionId: data.sessionId || data.session_id || data.sessionID || 'N/A',
                source: 'Bot Assessment - BroadcastChannel',
                originalData: data,
                botStatus: data.status || 'Unknown',
                originalScore: data.score || 0
            };
            
            console.log('‚úÖ BroadcastChannel data extracted:', result);
            return result;
        }

        // Enhanced candidate data extraction for regular messages
        function extractCandidateData(data) {
            console.log('üîç Extracting candidate data from:', data);
            
            // Extract basic info
            const name = data.name || data.candidate_name || data.candidateName || data.candidateDetails?.name || '';
            const email = data.email || data.candidate_email || data.candidateEmail || data.candidateDetails?.email || 
                         (name ? `${name.toLowerCase().replace(/\s+/g, '.')}@example.com` : '');
            const phone = data.phone || data.mobile || data.candidate_phone || data.candidatePhone || 
                         data.candidateDetails?.phone || '+44 0000 000000';
            
            // Extract score - handle different formats
            let score = 0;
            if (data.score !== undefined) {
                score = typeof data.score === 'string' && data.score.includes('/') ? 
                       (parseInt(data.score.split('/')[0]) / parseInt(data.score.split('/')[1])) * 100 :
                       parseInt(data.score);
            } else if (data.assessment_score !== undefined) {
                score = parseInt(data.assessment_score);
            } else if (data.finalScore !== undefined) {
                score = parseInt(data.finalScore);
            }
            
            // Handle bot status mapping from your bot
            let mappedScore = score;
            let status = 'failed';
            
            if (data.status === 'HIGHLY_SUITABLE' || score === 10 || (typeof data.score === 'string' && data.score === '10/10')) {
                mappedScore = 95; // High pass
                status = 'passed';
            } else if (data.status === 'SUITABLE' || score >= 7) {
                mappedScore = 75; // Waitlist
                status = 'waitlist';
            } else if (data.status === 'NOT_SUITABLE' || score < 7) {
                mappedScore = 45; // Fail
                status = 'failed';
            } else {
                // Use numeric score to determine status
                mappedScore = score > 10 ? score : score * 10; // Convert if needed
                status = mappedScore >= 80 ? 'passed' : mappedScore >= 60 ? 'waitlist' : 'failed';
            }
            
            const result = {
                name,
                email,
                phone,
                score: mappedScore,
                status,
                bootcamp: data.course || data.bootcamp || data.program || 'AI Fundamentals',
                responses: data.responses || data.answers || data.assessment_answers || ['Bot', 'Assessment', 'Completed'],
                location: data.location || 'Not specified',
                employmentStatus: data.employmentStatus || data.employment || 'Not specified',
                ukResidency: data.ukResidency || data.uk_residency || 'Not specified',
                interviewBooked: data.interviewBooked || data.interview_booked || data.interviewConfirmed || false,
                sessionId: data.sessionId || data.session_id || data.sessionID || 'N/A',
                source: 'Bot Assessment - GitHub Pages',
                originalData: data,
                botStatus: data.status || 'Unknown'
            };
            
            console.log('‚úÖ Extracted candidate data:', result);
            return result;
        }

        // Add new applicant (enhanced for BroadcastChannel debugging)
        function addNewApplicant(candidateData) {
            console.log('üìù Adding new applicant:', candidateData);
            
            const newApplicant = {
                id: Date.now() + Math.random(),
                ...candidateData,
                date: new Date().toISOString().split('T')[0],
                submissionTime: new Date().toLocaleString()
            };
            
            // Add to applicants array
            applicants.push(newApplicant);
            console.log(`üìä Total applicants after adding: ${applicants.length}`);
            console.log(`üìä New applicant details:`, {
                name: newApplicant.name,
                status: newApplicant.status,
                score: newApplicant.score,
                email: newApplicant.email,
                source: newApplicant.source
            });
            
            // Update statistics immediately
            updateStats();
            
            // Save to localStorage immediately
            saveToLocalStorage();
            
            // Refresh UI with detailed logging
            console.log('üîÑ Refreshing UI after adding applicant...');
            refreshUI();
            
            // Update bot stats
            botStats.totalReceived++;
            botStats.lastReceived = new Date().toLocaleString();
            botStats.connectionStatus = 'Connected';
            updateConnectionStatus();
            
            // Auto-save to Firebase
            if (database) {
                console.log('‚òÅÔ∏è Scheduling Firebase save...');
                setTimeout(saveToFirebase, 2000);
            }
            
            console.log(`‚úÖ Successfully added applicant: ${newApplicant.name} to ${newApplicant.status} section`);
            
            // Force scroll to applicant reports tab if not already there
            setTimeout(() => {
                const applicantTab = document.getElementById('tab-applicants');
                if (applicantTab && !applicantTab.classList.contains('tab-active')) {
                    console.log('üìç Switching to Applicant Reports tab to show new applicant');
                    switchTab('applicants');
                }
            }, 1000);
        }

        // üíæ DATA PERSISTENCE
        function saveToLocalStorage() {
            try {
                const data = { applicants, botStats, lastSaved: new Date().toISOString() };
                localStorage.setItem('aiBootcampDashboard', JSON.stringify(data));
                console.log('üíæ Saved to localStorage');
            } catch (error) {
                console.error('‚ùå localStorage save failed:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('aiBootcampDashboard');
                if (saved) {
                    const data = JSON.parse(saved);
                    if (data.applicants) {
                        applicants.length = 0;
                        applicants.push(...data.applicants);
                        if (data.botStats) Object.assign(botStats, data.botStats);
                        console.log('üì• Loaded from localStorage:', applicants.length, 'applicants');
                        return true;
                    }
                }
            } catch (error) {
                console.error('‚ùå localStorage load failed:', error);
            }
            return false;
        }

        // üî• FIREBASE INTEGRATION
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    firebaseApp = firebase.initializeApp(firebaseConfig);
                    database = firebase.database();
                    updateFirebaseStatus('connected');
                    console.log('üî• Firebase initialized');
                    setInterval(() => { if (applicants.length > 0) saveToFirebase(); }, 60000);
                } else {
                    updateFirebaseStatus('disconnected');
                }
            } catch (error) {
                console.error('‚ùå Firebase init failed:', error);
                updateFirebaseStatus('disconnected');
            }
        }

        function updateFirebaseStatus(status) {
            const el = document.getElementById('firebase-status');
            if (el) {
                el.className = `firebase-status firebase-${status}`;
                el.innerHTML = status === 'connected' ? 'üü¢ Firebase Connected' : 
                              status === 'saving' ? 'üü° Saving...' : 'üî¥ Firebase Offline';
            }
        }

        function saveToFirebase() {
            if (!database) return;
            updateFirebaseStatus('saving');
            
            const cleanData = {
                applicants: applicants.map(a => ({ ...a, responses: a.responses || [] })),
                botStats: { ...botStats },
                metadata: { totalApplicants: applicants.length, lastUpdated: new Date().toISOString() }
            };
            
            database.ref('aiBootcampDashboard').set(cleanData)
                .then(() => {
                    updateFirebaseStatus('connected');
                    console.log('‚òÅÔ∏è Saved to Firebase');
                })
                .catch(error => {
                    console.error('‚ùå Firebase save failed:', error);
                    updateFirebaseStatus('disconnected');
                });
        }

        function loadFromFirebase() {
            if (!database) return;
            
            database.ref('aiBootcampDashboard').once('value')
                .then(snapshot => {
                    const data = snapshot.val();
                    if (data && data.applicants) {
                        applicants.length = 0;
                        applicants.push(...data.applicants);
                        if (data.botStats) Object.assign(botStats, data.botStats);
                        saveToLocalStorage();
                        refreshUI();
                        showNotification(`üì• Loaded ${applicants.length} applicants from Firebase`, 'success');
                    } else {
                        showNotification('‚ÑπÔ∏è No data found in Firebase', 'info');
                    }
                })
                .catch(error => {
                    console.error('‚ùå Firebase load failed:', error);
                    showNotification('‚ùå Firebase load failed', 'error');
                });
        }

        // üìä UI FUNCTIONS
        function updateStats() {
            const total = applicants.length;
            const passed = applicants.filter(a => a.status === 'passed').length;
            const failed = applicants.filter(a => a.status === 'failed').length;
            const waitlist = applicants.filter(a => a.status === 'waitlist').length;
            const processed = applicants.filter(a => a.status === 'processed').length;
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-passed').textContent = passed;
            document.getElementById('stat-failed').textContent = failed;
            document.getElementById('stat-waitlist').textContent = waitlist;
            document.getElementById('stat-processed').textContent = processed;
            
            // Update applicant section counts
            const passedCountEl = document.getElementById('passed-count');
            const waitlistCountEl = document.getElementById('waitlist-count');
            const failedCountEl = document.getElementById('failed-count');
            const processedCountEl = document.getElementById('processed-count');
            
            if (passedCountEl) passedCountEl.textContent = passed;
            if (waitlistCountEl) waitlistCountEl.textContent = waitlist;
            if (failedCountEl) failedCountEl.textContent = failed;
            if (processedCountEl) processedCountEl.textContent = processed;
            
            document.title = `ü§ñ AI Bootcamp Dashboard (${total} applicants)`;
        }

        function refreshUI() {
            updateStats();
            populateRecentApplicants();
            populateApplicantSections();
            updateConnectionStatus();
        }

        function populateRecentApplicants() {
            const container = document.getElementById('recent-applicants');
            container.innerHTML = '';
            
            const recentApplicants = applicants.slice(-5).reverse(); // Show last 5, most recent first
            
            recentApplicants.forEach(applicant => {
                const statusColors = {
                    'passed': 'bg-green-100 text-green-800',
                    'failed': 'bg-red-100 text-red-800',
                    'waitlist': 'bg-yellow-100 text-yellow-800',
                    'processed': 'bg-purple-100 text-purple-800'
                };
                
                const statusColor = statusColors[applicant.status] || 'bg-gray-100 text-gray-800';
                
                container.innerHTML += `
                    <div class="px-8 py-6 flex items-center justify-between hover:bg-blue-50 transition-colors">
                        <div class="flex items-center space-x-6">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center shadow-lg">
                                <span class="text-sm font-bold text-white">${applicant.name.split(' ').map(n => n[0]).join('')}</span>
                            </div>
                            <div>
                                <p class="text-lg font-semibold text-gray-900">${applicant.name}</p>
                                <p class="text-sm text-gray-600">${applicant.email}</p>
                                ${applicant.source ? `<p class="text-xs text-blue-600 font-medium">${applicant.source}</p>` : ''}
                            </div>
                        </div>
                        <div class="flex items-center space-x-6">
                            <div class="text-right">
                                <p class="text-sm text-gray-600">${applicant.bootcamp}</p>
                                <p class="text-2xl font-bold text-brand">${applicant.score}%</p>
                            </div>
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold ${statusColor}">
                                ${applicant.status.toUpperCase()}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            if (recentApplicants.length === 0) {
                container.innerHTML = `
                    <div class="px-8 py-12 text-center text-gray-500">
                        <div class="text-4xl mb-4">üë•</div>
                        <p class="text-lg">No applicants yet</p>
                        <p class="text-sm">New applications will appear here</p>
                    </div>
                `;
            }
        }

        function populateApplicantSections() {
            ['passed', 'waitlist', 'failed', 'processed'].forEach(status => {
                const container = document.getElementById(status + '-applicants');
                if (!container) return;
                
                container.innerHTML = '';
                
                const filtered = applicants.filter(a => a.status === status);
                
                filtered.forEach(applicant => {
                    const statusConfig = {
                        'passed': { color: 'green', bgClass: 'bg-green-50', borderClass: 'border-green-200' },
                        'failed': { color: 'red', bgClass: 'bg-red-50', borderClass: 'border-red-200' },
                        'waitlist': { color: 'yellow', bgClass: 'bg-yellow-50', borderClass: 'border-yellow-200' },
                        'processed': { color: 'purple', bgClass: 'bg-purple-50', borderClass: 'border-purple-200' }
                    };
                    
                    const config = statusConfig[status];
                    
                    const actionButtons = status === 'processed' ? 
                        `<button onclick="restoreFromProcessed(${applicant.id})" class="w-full btn btn-gray mb-3 text-sm">‚Ü©Ô∏è Restore</button>
                         <button onclick="deleteApplicant(${applicant.id})" class="w-full btn btn-red text-sm">üóëÔ∏è Delete</button>` :
                        `<button onclick="showIndividualReport(${JSON.stringify(applicant).replace(/"/g, '&quot;')})" class="w-full btn btn-blue mb-3">üìã View Report</button>
                         <div class="flex space-x-3">
                             <button onclick="moveToProcessed(${applicant.id})" class="flex-1 btn btn-purple text-sm">‚úîÔ∏è Process</button>
                             <button onclick="deleteApplicant(${applicant.id})" class="flex-1 btn btn-red text-sm">üóëÔ∏è Delete</button>
                         </div>`;

                    container.innerHTML += `
                        <div class="applicant-card ${config.bgClass} ${config.borderClass}">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex-grow">
                                    <div class="flex items-center justify-between mb-3">
                                        <h4 class="text-xl font-bold text-gray-900">${applicant.name}</h4>
                                        <div class="score-badge">${applicant.score}%</div>
                                    </div>
                                    
                                    <div class="space-y-2 mb-4">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm text-gray-600">üìß ${applicant.email}</span>
                                            <button onclick="copyToClipboard('${applicant.email}')" class="copy-btn">üìã Copy</button>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm text-gray-600">üì± ${applicant.phone}</span>
                                            <button onclick="copyToClipboard('${applicant.phone}')" class="copy-btn">üìã Copy</button>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm text-gray-600">üë§ ${applicant.name}</span>
                                            <button onclick="copyToClipboard('${applicant.name}')" class="copy-btn">üìã Copy</button>
                                        </div>
                                        ${applicant.location && applicant.location !== 'Not specified' ? 
                                            `<p class="text-sm text-blue-600">üìç ${applicant.location}</p>` : ''}
                                        ${applicant.source ? 
                                            `<p class="text-xs text-blue-600 font-medium">${applicant.source}</p>` : ''}
                                        ${applicant.interviewBooked ? 
                                            `<p class="text-sm text-green-600 font-semibold">‚úÖ Interview Booked</p>` : ''}
                                    </div>
                                    
                                    <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                                        <span class="font-medium">${applicant.bootcamp}</span>
                                        <span>${applicant.date}</span>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <span class="status-badge status-${status}">${status.toUpperCase()}</span>
                                    </div>
                                </div>
                            </div>
                            ${actionButtons}
                        </div>
                    `;
                });
                
                if (filtered.length === 0) {
                    const emojis = { passed: '‚úÖ', failed: '‚ùå', waitlist: '‚è≥', processed: '‚úîÔ∏è' };
                    container.innerHTML = `
                        <div class="text-center py-12 text-gray-500">
                            <div class="text-6xl mb-4">${emojis[status]}</div>
                            <p class="text-xl">No ${status} applicants yet</p>
                            <p class="text-sm">New ${status} candidates will appear here</p>
                        </div>
                    `;
                }
            });
        }

        function updateConnectionStatus() {
            const statusEl = document.getElementById('connection-status');
            if (!statusEl) return;
            
            const firebaseStatus = database ? 'üü¢ Firebase' : 'üî¥ Offline';
            const botIcon = botStats.connectionStatus === 'Connected' ? 'üü¢' : 'üü°';
            
            statusEl.innerHTML = `
                <div class="flex items-center space-x-6 text-sm">
                    <span class="text-blue-100 bg-blue-800/30 px-3 py-1 rounded-full">${botIcon} Bot: ${botStats.connectionStatus}</span>
                    <span class="text-blue-100 bg-blue-800/30 px-3 py-1 rounded-full">${firebaseStatus}</span>
                    <span class="text-blue-100">Messages: ${botStats.totalReceived} | Last: ${botStats.lastReceived}</span>
                    <button onclick="showMessageLog()" class="text-cyan-200 hover:text-cyan-100 text-xs underline font-medium">View Log</button>
                </div>
            `;
        }

        // üîß UTILITY FUNCTIONS
        function switchTab(tabName) {
            document.querySelectorAll('[id^="content-"]').forEach(el => el.style.display = 'none');
            document.getElementById('content-' + tabName).style.display = 'block';
            
            document.querySelectorAll('[id^="tab-"]').forEach(el => el.className = el.className.replace('tab-active', 'tab-inactive'));
            document.getElementById('tab-' + tabName).className = document.getElementById('tab-' + tabName).className.replace('tab-inactive', 'tab-active');
        }

        function showModal(title, content) {
            // Modal disabled for applicant security - no popups visible
            console.log('Modal request blocked for security:', title);
            return false;
        }

        function closeModal() {
            // Modal disabled for applicant security
            return false;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification(`üìã Copied: ${text}`, 'success', 2000);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification(`üìã Copied: ${text}`, 'success', 2000);
            });
        }

        function showNotification(message, type = 'info', duration = 5000) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="font-medium">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200 text-xl">‚úï</button>
                </div>
            `;
            document.body.appendChild(notification);
            
            // Trigger animation
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Remove notification
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, duration);
        }

        // üîß ACTION FUNCTIONS
        function deleteApplicant(applicantId) {
            if (confirm('Delete this applicant permanently?')) {
                const index = applicants.findIndex(a => a.id === applicantId);
                if (index !== -1) {
                    const deleted = applicants[index];
                    applicants.splice(index, 1);
                    saveToLocalStorage();
                    refreshUI();
                    showNotification(`üóëÔ∏è Deleted ${deleted.name}`, 'success');
                    if (database) setTimeout(saveToFirebase, 1000);
                }
            }
        }

        function moveToProcessed(applicantId) {
            if (confirm('Mark this applicant as processed?')) {
                const applicant = applicants.find(a => a.id === applicantId);
                if (applicant) {
                    applicant.status = 'processed';
                    applicant.processedDate = new Date().toLocaleString();
                    saveToLocalStorage();
                    refreshUI();
                    showNotification(`‚úîÔ∏è Moved ${applicant.name} to processed`, 'success');
                    if (database) setTimeout(saveToFirebase, 1000);
                }
            }
        }

        function restoreFromProcessed(applicantId) {
            if (confirm('Restore this applicant to active status?')) {
                const applicant = applicants.find(a => a.id === applicantId);
                if (applicant) {
                    applicant.status = applicant.score >= 80 ? 'passed' : applicant.score >= 60 ? 'waitlist' : 'failed';
                    delete applicant.processedDate;
                    saveToLocalStorage();
                    refreshUI();
                    showNotification(`‚Ü©Ô∏è Restored ${applicant.name}`, 'success');
                    if (database) setTimeout(saveToFirebase, 1000);
                }
            }
        }

        function showCSVData() {
            // Silent operation - no popup for applicants
            const csv = [
                ['Name', 'Email', 'Phone', 'Date', 'Status', 'Score', 'Bootcamp'],
                ...applicants.map(a => [a.name, a.email, a.phone, a.date, a.status, a.score, a.bootcamp])
            ].map(row => row.join(',')).join('\n');
            console.log('CSV Data Generated (Hidden from applicants):', csv);
            showNotification('üìä Data processed (admin only)', 'info', 2000);
        }

        function showCategoryData(status) {
            // Silent operation - no popup for applicants
            const filtered = applicants.filter(a => a.status === status);
            const csv = [
                ['Name', 'Email', 'Phone', 'Date', 'Status', 'Score', 'Bootcamp'],
                ...filtered.map(a => [a.name, a.email, a.phone, a.date, a.status, a.score, a.bootcamp])
            ].map(row => row.join(',')).join('\n');
            console.log(`${status} Data Generated (Hidden from applicants):`, csv);
            showNotification(`üìä ${status} data processed (admin only)`, 'info', 2000);
        }

        function showIndividualReport(applicant) {
            // Silent operation - no popup for applicants  
            const report = `AI BOOTCAMP SCREENING REPORT
============================

APPLICANT INFORMATION
Name: ${applicant.name}
Email: ${applicant.email}
Phone: ${applicant.phone}
Date: ${applicant.date}
Bootcamp: ${applicant.bootcamp}
Source: ${applicant.source || 'Manual Entry'}

ENHANCED DETAILS
${applicant.location ? `Location: ${applicant.location}` : ''}
${applicant.employmentStatus ? `Employment: ${applicant.employmentStatus}` : ''}
${applicant.ukResidency ? `UK Residency: ${applicant.ukResidency}` : ''}
${applicant.interviewBooked ? `Interview Booked: Yes` : ''}
${applicant.sessionId ? `Session ID: ${applicant.sessionId}` : ''}

ASSESSMENT RESULTS
Score: ${applicant.score}%
Status: ${applicant.status.toUpperCase()}
${applicant.processedDate ? `Processed: ${applicant.processedDate}` : ''}

RESPONSES
${applicant.responses ? applicant.responses.map((r, i) => `${i+1}. ${r}`).join('\n') : 'No responses recorded'}

RECOMMENDATION
${applicant.status === 'passed' ? 'ACCEPTED - Candidate meets requirements' :
  applicant.status === 'waitlist' ? 'WAITLIST - Candidate shows potential' :
  applicant.status === 'failed' ? 'NOT ACCEPTED - Candidate needs improvement' :
  'PROCESSED - Application has been reviewed'}

Generated: ${new Date().toLocaleString()}`;
            console.log(`Individual Report Generated (Hidden from applicants):`, report);
            showNotification(`üìã Report generated for ${applicant.name} (admin only)`, 'info', 2000);
        }

        function testRealBotData() {
            console.log('üéØ Testing with REAL bot data from your screenshot...');
            
            // Exact data from your bot screenshot
            const realBotData = {
                name: 'Terence Edwin Herbert',
                email: 'terence.herbert75@gmail.com',
                mobile: '07857553275',
                phone: '07857553275',
                score: '10/10',
                status: 'HIGHLY_SUITABLE',
                interviewBooked: true,
                sessionId: '1752709265754',
                course: 'AI Business Productivity Bootcamp',
                from: 'bot.html',
                to: 'testbot.html'
            };
            
            console.log('üì® Simulating exact bot message:', realBotData);
            
            // Test the extraction
            const extracted = extractCandidateData(realBotData);
            console.log('üîç Extracted data:', extracted);
            
            if (extracted.name) {
                addNewApplicant(extracted);
                showNotification(`üéØ SUCCESS! Added real bot data: ${extracted.name} - ${extracted.status} (${extracted.score}%)`, 'success', 8000);
                
                // Auto switch to applicants tab
                setTimeout(() => {
                    switchTab('applicants');
                    showNotification('üìç Switched to Applicant Reports - Look for Terence in Passed section!', 'info', 5000);
                }, 2000);
            } else {
                showNotification('‚ùå Failed to process real bot data - check extraction logic', 'error');
            }
        }

        function testBotIntegration() {
            const testData = {
                name: 'Test Candidate ' + Math.floor(Math.random() * 1000),
                email: 'test' + Math.floor(Math.random() * 1000) + '@example.com',
                phone: '+1 (555) 999-' + Math.floor(Math.random() * 10000).toString().padStart(4, '0'),
                score: Math.floor(Math.random() * 100),
                bootcamp: 'Test Course',
                responses: ['Test', 'Data', 'From', 'Dashboard'],
                source: 'Dashboard Test'
            };
            
            addNewApplicant(testData);
            showNotification('üß™ Test applicant added successfully!', 'success');
        }

        function debugBotConnection() {
            const report = `üîß BOT CONNECTION DEBUG
============================

DASHBOARD STATUS:
- URL: ${window.location.href}
- Origin: ${window.location.origin}
- Has Parent: ${window.parent !== window}
- In Frame: ${window !== window.top}

CONNECTION STATS:
- Messages Received: ${messageLog.length}
- Bot Status: ${botStats.connectionStatus}
- Last Message: ${botStats.lastReceived}
- Total Applicants: ${applicants.length}

MESSAGE LOG (Last 10):
${messageLog.slice(-10).map(log => 
    `${log.timestamp.split('T')[1].slice(0,8)} | ${log.origin} | ${JSON.stringify(log.data).slice(0, 100)}...`
).join('\n')}

INTEGRATION CODE FOR BOT.HTML:
// Test connection
window.parent.postMessage({messageType: 'CONNECTION_TEST'}, '*');

// Send candidate data
window.parent.postMessage({
    name: 'John Doe',
    email: 'john@example.com',
    score: 85,
    bootcamp: 'AI Fundamentals'
}, '*');

TROUBLESHOOTING:
1. Check browser console for errors
2. Ensure dashboard is parent window
3. Verify postMessage syntax
4. Check CORS/security restrictions`;
            console.log('üîß Bot Connection Debug Report:', report);
            showNotification('üîß Debug info logged to console (admin only)', 'info', 3000);
        }

        function showMessageLog() {
            const logContent = messageLog.length === 0 ? 'No messages received yet.' :
                messageLog.slice(-20).map(log => 
                    `${log.timestamp} | ${log.origin} | ${JSON.stringify(log.data)}`
                ).join('\n');
            console.log('üì® Message Log (Last 20):', logContent);
            showNotification('üì® Message log displayed in console (admin only)', 'info', 2000);
        }

        function testFirebase() {
            if (!database) {
                showNotification('‚ùå Firebase not connected', 'error');
                return;
            }
            
            const testData = { test: true, timestamp: new Date().toISOString() };
            database.ref('test').set(testData)
                .then(() => showNotification('‚úÖ Firebase test successful', 'success'))
                .catch(error => showNotification('‚ùå Firebase test failed: ' + error.message, 'error'));
        }

        function resetToTestData() {
            if (confirm('Reset to demo data? This will delete all current applicants.')) {
                applicants.length = 0;
                applicants.push(...originalTestData);
                botStats = { totalReceived: 0, lastReceived: 'Never', connectionStatus: 'Ready', lastPing: 'Never' };
                saveToLocalStorage();
                refreshUI();
                showNotification('üîÑ Reset to demo data complete', 'success');
            }
        }

        function createChatbot() {
            const name = document.getElementById('chatbot-name').value;
            if (name.trim()) {
                console.log(`ü§ñ Chatbot "${name}" created successfully! (Demo feature)`);
                showNotification(`ü§ñ Chatbot "${name}" created successfully!`, 'success');
                document.getElementById('chatbot-name').value = '';
            }
        }

        // üöÄ INITIALIZATION
        function initializeDashboard() {
            console.log('üöÄ Initializing AI Bootcamp Dashboard with BroadcastChannel');
            
            // Check if this is the expected testbot.html file
            const currentPath = window.location.pathname;
            const isTestbotFile = currentPath.includes('testbot.html');
            
            if (!isTestbotFile) {
                console.log('‚ö†Ô∏è Dashboard not running as testbot.html - bot may not connect');
                setTimeout(() => {
                    showNotification(`‚ö†Ô∏è IMPORTANT: Your bot expects "testbot.html" but this is "${currentPath.split('/').pop()}". Click "üîß Debug Bot" for solutions.`, 'error', 10000);
                }, 3000);
            }
            
            // Initialize BroadcastChannel for cross-tab communication
            initializeBroadcastChannel();
            
            // Load data
            if (!loadFromLocalStorage()) {
                applicants.push(...originalTestData);
                saveToLocalStorage();
                showNotification('üëã Welcome! Demo data loaded.', 'info');
            } else {
                showNotification('üì• Loaded saved data', 'success');
            }
            
            // Initialize Firebase
            initializeFirebase();
            
            // Setup UI
            refreshUI();
            
            // Setup API for bot
            window.addApplicantReport = function(data) {
                console.log('üîó Direct API call:', data);
                const candidateData = extractCandidateData(data);
                if (candidateData.name) addNewApplicant(candidateData);
                return { status: 'success', timestamp: new Date().toISOString() };
            };
            
            // Add verification function for bot
            window.verifyDashboardConnection = function() {
                console.log('üîß Bot verification request received');
                showNotification('‚úÖ Bot verification successful - Dashboard ready!', 'success');
                return {
                    status: 'connected',
                    dashboardReady: true,
                    url: window.location.href,
                    timestamp: new Date().toISOString()
                };
            };
            
            console.log('‚úÖ Dashboard ready for bot integration with BroadcastChannel!');
            console.log(`üìç Dashboard URL: ${window.location.href}`);
            console.log(`üì° BroadcastChannel: bot_channel`);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
</body>
</html>
