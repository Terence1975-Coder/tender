<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ AI Bootcamp Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <!--
    ü§ñ BOT INTEGRATION INSTRUCTIONS
    ================================
    
    Your bot at https://terence1975-coder.github.io/tender/bot.html can send reports to this dashboard using these methods:
    
    METHOD 1: PostMessage (Recommended)
    -----------------------------------
    From your bot, use:
    
    const reportData = {
        name: "John Doe",
        email: "john@example.com", 
        phone: "+1 (555) 123-4567",
        score: 85,
        bootcamp: "AI Fundamentals",
        responses: ["Correct", "Correct", "Incorrect", "Correct", "Correct"],
        autoShow: true  // Optional: auto-display the report
    };
    
    // Send to dashboard
    window.parent.postMessage(reportData, '*');
    
    METHOD 2: Direct Function Call
    ------------------------------
    If dashboard is in same window/iframe:
    
    parent.addApplicantReport(reportData);
    
    METHOD 3: URL Parameters
    ------------------------
    Redirect to dashboard with data:
    
    const encoded = encodeURIComponent(JSON.stringify(reportData));
    window.location.href = 'dashboard.html?report=' + encoded;
    
    SCORING RULES:
    - Score 80+ = Passed (Green)
    - Score 60-79 = Waitlist (Yellow) 
    - Score <60 = Failed (Red)
    
    The dashboard will automatically categorize and display the reports!
    -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; }
        .tab-active { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
        .tab-inactive { border-bottom: 2px solid transparent; color: #6b7280; }
        .tab-inactive:hover { color: #374151; border-bottom-color: #d1d5db; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 50; }
        .modal.show { display: flex; align-items: center; justify-content: center; padding: 1rem; }
        .btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 500; transition: all 0.2s; cursor: pointer; border: none; }
        .btn-green { background: #16a34a; color: white; } .btn-green:hover { background: #15803d; }
        .btn-blue { background: #2563eb; color: white; } .btn-blue:hover { background: #1d4ed8; }
        .btn-yellow { background: #ca8a04; color: white; } .btn-yellow:hover { background: #a16207; }
        .btn-red { background: #dc2626; color: white; } .btn-red:hover { background: #b91c1c; }
        .btn-gray { background: #f3f4f6; color: #374151; } .btn-gray:hover { background: #e5e7eb; }
        .card { background: white; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border: 1px solid #e5e7eb; }
        .card:hover { box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .status-passed { background: #dcfce7; color: #166534; }
        .status-failed { background: #fecaca; color: #991b1b; }
        .status-waitlist { background: #fef3c7; color: #92400e; }
        .status-processed { background: #dbeafe; color: #1e40af; }
        .upload-zone { border: 2px dashed #d1d5db; transition: border-color 0.2s; }
        .upload-zone:hover { border-color: #9ca3af; }
        .firebase-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            color: white;
            font-size: 0.9em;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .firebase-connected {
            background: #27ae60;
            box-shadow: 0 2px 10px rgba(39, 174, 96, 0.3);
        }
        .firebase-disconnected {
            background: #e74c3c;
            box-shadow: 0 2px 10px rgba(231, 76, 60, 0.3);
        }
        .firebase-saving {
            background: #f39c12;
            box-shadow: 0 2px 10px rgba(243, 156, 18, 0.3);
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Firebase Status Indicator -->
    <div id="firebase-status" class="firebase-status firebase-disconnected">
        üî¥ Firebase Disconnected
    </div>

    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">ü§ñ AI Bootcamp Dashboard</h1>
                    <p class="text-gray-600">Manage screening applications and chatbots</p>
                    <div id="connection-status" class="mt-2">
                        <!-- Bot connection status will be populated here -->
                    </div>
                </div>
                <div class="flex flex-col space-y-2">
                    <div class="flex space-x-2">
                        <button onclick="showCSVData()" class="btn btn-green">
                            üì• Show Excel Data
                        </button>
                        <button onclick="testBotIntegration()" class="btn btn-blue text-sm">
                            üîó Test Bot Connection
                        </button>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="saveToFirebase()" class="btn btn-blue text-sm">
                            ‚òÅÔ∏è Save to Cloud
                        </button>
                        <button onclick="loadFromFirebase()" class="btn btn-gray text-sm">
                            üì• Load from Cloud
                        </button>
                    </div>
                </div>
            </div>

            <!-- Processed Applicants Section -->
            <div class="card overflow-hidden">
                <div class="bg-blue-50 px-6 py-4 border-b border-blue-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-medium text-blue-800">‚úîÔ∏è Processed Applicants (<span id="processed-count">0</span>)</h3>
                        <button onclick="showCategoryData('processed')" class="text-blue-700 hover:text-blue-900 text-sm flex items-center space-x-1 transition-colors">
                            <div class="text-lg">üì•</div>
                            <span>Export Data</span>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="processed-applicants">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="border-b border-gray-200">
            <nav class="flex space-x-8">
                <button onclick="switchTab('overview')" id="tab-overview" class="tab-active py-2 px-1 font-medium text-sm flex items-center space-x-2">
                    üìä Overview
                </button>
                <button onclick="switchTab('applicants')" id="tab-applicants" class="tab-inactive py-2 px-1 font-medium text-sm flex items-center space-x-2">
                    üë• Applicant Reports
                </button>
                <button onclick="switchTab('chatbots')" id="tab-chatbots" class="tab-inactive py-2 px-1 font-medium text-sm flex items-center space-x-2">
                    ‚öôÔ∏è Manage Chatbots
                </button>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Overview Tab -->
        <div id="content-overview" class="space-y-6">
            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                <div class="card p-6">
                    <div class="flex items-center">
                        <div class="text-3xl">üë•</div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total Applicants</p>
                            <p class="text-2xl font-bold text-gray-900" id="stat-total">8</p>
                        </div>
                    </div>
                </div>
                <div class="card p-6">
                    <div class="flex items-center">
                        <div class="text-3xl">‚úÖ</div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Passed</p>
                            <p class="text-2xl font-bold text-gray-900" id="stat-passed">4</p>
                        </div>
                    </div>
                </div>
                <div class="card p-6">
                    <div class="flex items-center">
                        <div class="text-3xl">‚ùå</div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Failed</p>
                            <p class="text-2xl font-bold text-gray-900" id="stat-failed">2</p>
                        </div>
                    </div>
                </div>
                <div class="card p-6">
                    <div class="flex items-center">
                        <div class="text-3xl">‚è≥</div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Waitlist</p>
                            <p class="text-2xl font-bold text-gray-900" id="stat-waitlist">2</p>
                        </div>
                    </div>
                </div>
                <div class="card p-6">
                    <div class="flex items-center">
                        <div class="text-3xl">‚úîÔ∏è</div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Processed</p>
                            <p class="text-2xl font-bold text-gray-900" id="stat-processed">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <div class="px-6 py-4 border-b">
                    <h3 class="text-lg font-medium text-gray-900">üìù Recent Applications</h3>
                </div>
                <div class="divide-y divide-gray-200" id="recent-applicants">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Applicants Tab -->
        <div id="content-applicants" class="space-y-6" style="display: none;">
            <!-- Filter Controls -->
            <div class="card p-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0">
                    <div>
                        <h3 class="text-lg font-medium text-gray-900">üìä Applicant Reports</h3>
                        <p class="text-sm text-gray-500">Individual reports grouped by status</p>
                    </div>
                    <button onclick="showCSVData()" class="btn btn-blue">
                        üì• Show All Data
                    </button>
                </div>
            </div>

            <!-- Passed Applicants -->
            <div class="card overflow-hidden">
                <div class="bg-green-50 px-6 py-4 border-b border-green-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-medium text-green-800">‚úÖ Passed Applicants (4)</h3>
                        <button onclick="showCategoryData('passed')" class="text-green-700 hover:text-green-900 text-sm">
                            üì• Export Data
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="passed-applicants">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Waitlist Applicants -->
            <div class="card overflow-hidden">
                <div class="bg-yellow-50 px-6 py-4 border-b border-yellow-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-medium text-yellow-800">‚è≥ Waitlist Applicants (2)</h3>
                        <button onclick="showCategoryData('waitlist')" class="text-yellow-700 hover:text-yellow-900 text-sm">
                            üì• Export Data
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="waitlist-applicants">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Failed Applicants -->
            <div class="card overflow-hidden">
                <div class="bg-red-50 px-6 py-4 border-b border-red-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-medium text-red-800">‚ùå Failed Applicants (2)</h3>
                        <button onclick="showCategoryData('failed')" class="text-red-700 hover:text-red-900 text-sm">
                            üì• Export Data
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="failed-applicants">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Chatbots Tab -->
        <div id="content-chatbots" class="space-y-6" style="display: none;">
            <!-- Create New Chatbot -->
            <div class="card p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">ü§ñ Create New Screening Chatbot</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Chatbot Name</label>
                        <input type="text" id="chatbot-name" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter chatbot name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Course/Bootcamp</label>
                        <select id="chatbot-course" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option>AI Fundamentals</option>
                            <option>Machine Learning</option>
                            <option>Data Science</option>
                            <option>Deep Learning</option>
                        </select>
                    </div>
                </div>
                <div class="mt-4">
                    <button onclick="createChatbot()" class="btn btn-blue">
                        ‚ûï Create Chatbot
                    </button>
                </div>
            </div>

            <!-- Upload Script -->
            <div class="card p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">üìù Upload New Script</h3>
                <div class="upload-zone rounded-lg p-6 text-center">
                    <div class="text-4xl mb-4">üì§</div>
                    <p class="text-sm text-gray-600 mb-2">Drop your script file here or click to upload</p>
                    <p class="text-xs text-gray-500 mb-4">Supported formats: .js, .json, .txt</p>
                    <input type="file" id="script-upload" style="display: none" accept=".js,.json,.txt" onchange="handleFileUpload(this, 'Script')">
                    <button onclick="document.getElementById('script-upload').click()" class="btn btn-gray">
                        Choose File
                    </button>
                </div>
            </div>

            <!-- Upload Course Info -->
            <div class="card p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">üìö Upload Bootcamp/Course Info</h3>
                <div class="upload-zone rounded-lg p-6 text-center">
                    <div class="text-4xl mb-4">üì§</div>
                    <p class="text-sm text-gray-600 mb-2">Drop your course information file here or click to upload</p>
                    <p class="text-xs text-gray-500 mb-4">Supported formats: .pdf, .doc, .docx, .txt</p>
                    <input type="file" id="course-upload" style="display: none" accept=".pdf,.doc,.docx,.txt" onchange="handleFileUpload(this, 'Course Info')">
                    <button onclick="document.getElementById('course-upload').click()" class="btn btn-gray">
                        Choose File
                    </button>
                </div>
            </div>

            <!-- Existing Chatbots -->
            <div class="card overflow-hidden">
                <div class="px-6 py-4 border-b">
                    <h3 class="text-lg font-medium text-gray-900">ü§ñ Existing Chatbots</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Course</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Created</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="chatbots-table">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl">
            <div class="flex justify-between items-center p-6 border-b bg-gray-50">
                <h2 id="modal-title" class="text-xl font-semibold text-gray-900">Modal Title</h2>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">‚ùå</button>
            </div>
            <div class="p-6 overflow-auto max-h-[70vh]">
                <textarea id="modal-content" readonly class="w-full h-96 p-4 border border-gray-300 rounded-md font-mono text-sm bg-gray-50 resize-none" placeholder="Content will appear here..."></textarea>
                <div class="mt-4 flex justify-between items-center">
                    <p class="text-sm text-gray-600">üí° Select all content above (Ctrl+A) and copy (Ctrl+C) to save</p>
                    <button onclick="copyToClipboard()" id="copy-btn" class="btn btn-blue">Copy to Clipboard</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dynamic applicants array - will receive new data from bot
        let applicants = [
            { id: 1, name: 'John Smith', email: 'john@email.com', phone: '+1 (555) 123-4567', date: '2025-01-15', status: 'passed', score: 85, bootcamp: 'AI Fundamentals', responses: ['Correct', 'Correct', 'Incorrect', 'Correct', 'Correct'] },
            { id: 2, name: 'Sarah Johnson', email: 'sarah@email.com', phone: '+1 (555) 234-5678', date: '2025-01-14', status: 'failed', score: 45, bootcamp: 'AI Fundamentals', responses: ['Incorrect', 'Correct', 'Incorrect', 'Incorrect', 'Correct'] },
            { id: 3, name: 'Mike Chen', email: 'mike@email.com', phone: '+1 (555) 345-6789', date: '2025-01-13', status: 'waitlist', score: 65, bootcamp: 'AI Fundamentals', responses: ['Correct', 'Incorrect', 'Correct', 'Correct', 'Incorrect'] },
            { id: 4, name: 'Emily Davis', email: 'emily@email.com', phone: '+1 (555) 456-7890', date: '2025-01-12', status: 'passed', score: 92, bootcamp: 'Machine Learning', responses: ['Correct', 'Correct', 'Correct', 'Correct', 'Incorrect'] },
            { id: 5, name: 'Alex Rodriguez', email: 'alex@email.com', phone: '+1 (555) 567-8901', date: '2025-01-11', status: 'passed', score: 78, bootcamp: 'AI Fundamentals', responses: ['Correct', 'Correct', 'Incorrect', 'Correct', 'Correct'] },
            { id: 6, name: 'Lisa Wang', email: 'lisa@email.com', phone: '+1 (555) 678-9012', date: '2025-01-10', status: 'waitlist', score: 68, bootcamp: 'Machine Learning', responses: ['Correct', 'Correct', 'Incorrect', 'Correct', 'Incorrect'] },
            { id: 7, name: 'David Brown', email: 'david@email.com', phone: '+1 (555) 789-0123', date: '2025-01-09', status: 'failed', score: 42, bootcamp: 'AI Fundamentals', responses: ['Incorrect', 'Incorrect', 'Correct', 'Incorrect', 'Correct'] },
            { id: 8, name: 'Jennifer Lee', email: 'jennifer@email.com', phone: '+1 (555) 890-1234', date: '2025-01-08', status: 'passed', score: 89, bootcamp: 'Machine Learning', responses: ['Correct', 'Correct', 'Correct', 'Incorrect', 'Correct'] }
        ];

        // Bot Integration - Statistics tracking
        let botStats = {
            totalReceived: 0,
            lastReceived: null,
            connectionStatus: 'Ready'
        };

        // üî• FIREBASE INTEGRATION
        const firebaseConfig = {
            apiKey: "AIzaSyChiAlrD-JLtBSDN3sOyxYiLGig-6Cy3GM",
            authDomain: "prospecting-f2f42.firebaseapp.com",
            databaseURL: "https://prospecting-f2f42-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "prospecting-f2f42",
            storageBucket: "prospecting-f2f42.firebasestorage.app",
            messagingSenderId: "292034226428",
            appId: "1:292034226428:web:878b867e3eb4d3e0098f79",
            measurementId: "G-WWB0JTX2L2"
        };

        let database = null;
        let firebaseApp = null;

        // Initialize Firebase
        function initializeFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    firebaseApp = firebase.initializeApp(firebaseConfig);
                    database = firebase.database();
                    updateFirebaseStatus('connected');
                    console.log('üî• Firebase initialized successfully');
                    
                    // Auto-load data on startup
                    loadFromFirebase();
                    
                    // Set up auto-save every 60 seconds
                    setInterval(autoSaveToFirebase, 60000);
                } else {
                    console.log('Firebase not available - running in offline mode');
                    updateFirebaseStatus('disconnected');
                }
            } catch (error) {
                console.error('Firebase initialization failed:', error);
                updateFirebaseStatus('disconnected');
                console.log('Continuing in offline mode');
            }
        }

        // Update Firebase status indicator
        function updateFirebaseStatus(status) {
            const statusElement = document.getElementById('firebase-status');
            if (!statusElement) return;
            
            if (status === 'connected') {
                statusElement.className = 'firebase-status firebase-connected';
                statusElement.innerHTML = 'üü¢ Firebase Connected';
            } else if (status === 'saving') {
                statusElement.className = 'firebase-status firebase-saving';
                statusElement.innerHTML = 'üü° Saving to Cloud...';
            } else {
                statusElement.className = 'firebase-status firebase-disconnected';
                statusElement.innerHTML = 'üî¥ Firebase Disconnected';
            }
        }

        // Collect all dashboard data for Firebase
        function getAllDashboardData() {
            return {
                applicants: applicants,
                botStats: botStats,
                metadata: {
                    totalApplicants: applicants.length,
                    passed: applicants.filter(a => a.status === 'passed').length,
                    failed: applicants.filter(a => a.status === 'failed').length,
                    waitlist: applicants.filter(a => a.status === 'waitlist').length,
                    processed: applicants.filter(a => a.status === 'processed').length,
                    lastUpdated: new Date().toISOString()
                }
            };
        }

        // Save to Firebase
        function saveToFirebase() {
            if (!database) {
                showNotification('‚ùå Firebase not connected. Please check your configuration.', 'error');
                return;
            }

            updateFirebaseStatus('saving');
            const allData = getAllDashboardData();
            const timestamp = new Date().toISOString();

            database.ref('aiBootcampDashboard').set({
                ...allData,
                lastSaved: timestamp,
                version: '1.0'
            }).then(() => {
                updateFirebaseStatus('connected');
                showNotification('‚úÖ Dashboard data saved to Firebase successfully!', 'success');
                console.log('üî• Dashboard data saved to Firebase at:', timestamp);
            }).catch((error) => {
                updateFirebaseStatus('disconnected');
                showNotification('‚ùå Failed to save to Firebase: ' + error.message, 'error');
                console.error('Firebase save error:', error);
            });
        }

        // Auto-save to Firebase
        function autoSaveToFirebase() {
            if (!database || applicants.length === 0) return;

            updateFirebaseStatus('saving');
            const allData = getAllDashboardData();

            database.ref('aiBootcampDashboard').update({
                ...allData,
                lastAutoSaved: new Date().toISOString()
            }).then(() => {
                updateFirebaseStatus('connected');
                console.log('üî• Auto-saved dashboard to Firebase');
                showSaveConfirmation();
            }).catch((error) => {
                updateFirebaseStatus('disconnected');
                console.error('Auto-save failed:', error);
            });
        }

        // Save confirmation visual feedback
        function showSaveConfirmation() {
            const confirmation = document.createElement('div');
            confirmation.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: #27ae60;
                color: white;
                padding: 10px 20px;
                border-radius: 20px;
                font-weight: 600;
                z-index: 1001;
                box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
                transition: all 0.3s ease;
            `;
            confirmation.textContent = '‚úì Auto-Saved';
            document.body.appendChild(confirmation);

            setTimeout(() => {
                confirmation.style.opacity = '0';
                confirmation.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (confirmation.parentNode) {
                        confirmation.parentNode.removeChild(confirmation);
                    }
                }, 300);
            }, 2000);
        }

        // Load from Firebase
        function loadFromFirebase() {
            if (!database) {
                showNotification('‚ùå Firebase not connected. Please check your configuration.', 'error');
                return;
            }

            database.ref('aiBootcampDashboard').once('value').then((snapshot) => {
                const firebaseData = snapshot.val();

                if (!firebaseData || !firebaseData.applicants) {
                    console.log('No dashboard data found in Firebase');
                    showNotification('‚ÑπÔ∏è No saved data found in Firebase', 'info');
                    return;
                }

                // Load applicants data
                applicants.length = 0; // Clear existing data
                applicants.push(...firebaseData.applicants);

                // Load bot stats if available
                if (firebaseData.botStats) {
                    Object.assign(botStats, firebaseData.botStats);
                }

                // Refresh the entire UI
                refreshAllSections();

                const lastSaved = firebaseData.lastSaved || firebaseData.lastAutoSaved;
                showNotification(`‚úÖ Dashboard data loaded from Firebase!`, 'success');
                console.log('üî• Dashboard data loaded from Firebase:', lastSaved);

            }).catch((error) => {
                showNotification('‚ùå Failed to load from Firebase: ' + error.message, 'error');
                console.error('Firebase load error:', error);
            });
        }

        // Setup auto-save triggers
        function setupAutoSaveTriggers() {
            // Auto-save when new applicants are added
            const originalPush = applicants.push;
            applicants.push = function(...items) {
                const result = originalPush.apply(this, items);
                if (database) {
                    setTimeout(autoSaveToFirebase, 2000); // Save 2 seconds after new data
                }
                return result;
            };
        }

        // ü§ñ BOT INTEGRATION FUNCTIONS
        
        // Enhanced listener for messages from bot.html with security and message types
        window.addEventListener('message', function(event) {
            console.log('üì® Received message from:', event.origin, 'Data:', event.data);
            
            // Security check - accept from your domain and localhost for testing
            if (!event.origin.includes('github.io') && !event.origin.includes('localhost')) {
                console.log('üö´ Rejected message from unauthorized origin:', event.origin);
                return;
            }
            
            // Handle structured messages with messageType (new format)
            if (event.data && event.data.messageType) {
                console.log('üìä Processing structured message:', event.data.messageType);
                
                if (event.data.messageType === 'CANDIDATE_REPORT') {
                    console.log('‚úÖ Candidate report received:', event.data.name, 'Score:', event.data.score);
                    displayCandidateReport(event.data);
                    
                    // Auto-show modal if requested
                    if (event.data.autoShow) {
                        showCandidateModal(event.data);
                    }
                    
                    return;
                }
                
                if (event.data.messageType === 'CONNECTION_TEST') {
                    console.log('üîß Connection test successful from bot.html');
                    showNotification('‚úÖ Connection test successful! bot.html can communicate with dashboard', 'success');
                    return;
                }
            }
            
            // Handle legacy format (backwards compatibility)
            if (event.data && (event.data.name || event.data.email)) {
                console.log('üì® Processing legacy format message');
                processIncomingReport(event.data);
            }
        });

        // Function to display candidate data (new structured format)
        function displayCandidateReport(candidateData) {
            console.log('üéØ Displaying candidate report:', candidateData);
            
            // Convert structured format to our internal format
            const reportData = {
                name: candidateData.name || 'Unknown Candidate',
                email: candidateData.email || 'no-email@example.com',
                phone: candidateData.phone || '+1 (555) 000-0000',
                score: candidateData.score || 0,
                bootcamp: candidateData.course || candidateData.bootcamp || 'AI Fundamentals',
                responses: candidateData.responses || candidateData.answers || ['Unknown', 'Unknown', 'Unknown', 'Unknown', 'Unknown'],
                autoShow: candidateData.autoShow || false,
                messageType: candidateData.messageType // Preserve message type
            };
            
            // Process using existing system
            processIncomingReport(reportData);
            
            // Show additional notification for structured reports
            showNotification(`üìä Structured report received: ${reportData.name} (Score: ${reportData.score})`, 'success');
        }

        // Function to show candidate modal (enhanced)
        function showCandidateModal(candidateData) {
            console.log('üìã Showing modal for candidate:', candidateData.name);
            
            // Create a temporary applicant object for the modal
            const tempApplicant = {
                id: Date.now(),
                name: candidateData.name || 'Unknown Candidate',
                email: candidateData.email || 'no-email@example.com',
                phone: candidateData.phone || '+1 (555) 000-0000',
                date: new Date().toISOString().split('T')[0],
                status: determineStatus(candidateData.score || 0),
                score: candidateData.score || 0,
                bootcamp: candidateData.course || candidateData.bootcamp || 'AI Fundamentals',
                responses: candidateData.responses || candidateData.answers || ['Unknown', 'Unknown', 'Unknown', 'Unknown', 'Unknown'],
                submissionTime: new Date().toLocaleString(),
                source: 'Bot Submission (Structured)',
                messageType: candidateData.messageType
            };
            
            // Show the individual report modal
            showIndividualReport(tempApplicant);
        }

        // Process URL parameters for direct report submission
        function checkURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('report')) {
                try {
                    const reportData = JSON.parse(decodeURIComponent(urlParams.get('report')));
                    processIncomingReport(reportData);
                    // Clean URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                } catch (e) {
                    console.error('Error parsing URL report data:', e);
                }
            }
        }

        // Main function to process incoming reports
        function processIncomingReport(data) {
            console.log('üîÑ Processing incoming report:', data);
            
            // Update connection status
            botStats.connectionStatus = 'Connected';
            botStats.lastReceived = new Date().toLocaleString();
            botStats.totalReceived++;
            updateConnectionStatus();
            
            // Validate and process the report data
            if (data && data.name && data.email) {
                // Create new applicant object
                const newApplicant = {
                    id: Date.now(), // Generate unique ID
                    name: data.name || 'Unknown Applicant',
                    email: data.email || 'no-email@example.com',
                    phone: data.phone || '+1 (555) 000-0000',
                    date: new Date().toISOString().split('T')[0],
                    status: determineStatus(data.score || 0),
                    score: data.score || 0,
                    bootcamp: data.bootcamp || data.course || 'AI Fundamentals',
                    responses: data.responses || ['Unknown', 'Unknown', 'Unknown', 'Unknown', 'Unknown'],
                    submissionTime: new Date().toLocaleString(),
                    source: 'Bot Submission'
                };
                
                // Add to applicants array
                applicants.push(newApplicant);
                
                // Update UI
                refreshAllSections();
                
                // Show success notification
                showNotification(`‚úÖ New applicant received: ${newApplicant.name} (${newApplicant.status})`, 'success');
                
                // Auto-save to Firebase
                if (database) {
                    setTimeout(autoSaveToFirebase, 3000);
                }
                
                // Auto-show report if requested
                if (data.autoShow) {
                    setTimeout(() => showIndividualReport(newApplicant), 1000);
                }
                
                console.log('‚úÖ Successfully added new applicant:', newApplicant);
            } else {
                console.error('‚ùå Invalid report data received:', data);
                showNotification('‚ùå Invalid report data received', 'error');
            }
        }

        // Determine status based on score
        function determineStatus(score) {
            if (score >= 80) return 'passed';
            if (score >= 60) return 'waitlist';
            return 'failed';
        }

        // Update connection status indicator
        function updateConnectionStatus() {
            const statusEl = document.getElementById('connection-status');
            if (statusEl) {
                const firebaseStatus = database ? 'üü¢ Firebase' : 'üî¥ Offline';
                statusEl.innerHTML = `
                    <div class="flex items-center space-x-4 text-sm">
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 rounded-full ${botStats.connectionStatus === 'Connected' ? 'bg-green-500' : 'bg-yellow-500'}"></div>
                            <span class="text-gray-600">Bot: ${botStats.connectionStatus}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-gray-600">${firebaseStatus}</span>
                        </div>
                        <div class="text-gray-500">
                            Reports: ${botStats.totalReceived} | Last: ${botStats.lastReceived || 'Never'}
                        </div>
                    </div>
                `;
            }
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Refresh all UI sections with new data
        function refreshAllSections() {
            // Update statistics
            updateStatistics();
            
            // Clear and repopulate all sections
            document.getElementById('recent-applicants').innerHTML = '';
            document.getElementById('passed-applicants').innerHTML = '';
            document.getElementById('waitlist-applicants').innerHTML = '';
            document.getElementById('failed-applicants').innerHTML = '';
            document.getElementById('processed-applicants').innerHTML = '';
            
            // Re-initialize with updated data
            populateRecentApplicants();
            populateApplicantSections();
            updateSectionCounts();
        }

        // Update statistics cards
        function updateStatistics() {
            const totalCount = applicants.length;
            const passedCount = applicants.filter(a => a.status === 'passed').length;
            const failedCount = applicants.filter(a => a.status === 'failed').length;
            const waitlistCount = applicants.filter(a => a.status === 'waitlist').length;
            const processedCount = applicants.filter(a => a.status === 'processed').length;

            // Update the numbers in statistics cards
            document.getElementById('stat-total').textContent = totalCount;
            document.getElementById('stat-passed').textContent = passedCount;
            document.getElementById('stat-failed').textContent = failedCount;
            document.getElementById('stat-waitlist').textContent = waitlistCount;
            document.getElementById('stat-processed').textContent = processedCount;
        }

        // Update section count headers
        function updateSectionCounts() {
            const passedCount = applicants.filter(a => a.status === 'passed').length;
            const waitlistCount = applicants.filter(a => a.status === 'waitlist').length;
            const failedCount = applicants.filter(a => a.status === 'failed').length;
            const processedCount = applicants.filter(a => a.status === 'processed').length;

            // Update count displays
            const processedCountEl = document.getElementById('processed-count');
            if (processedCountEl) processedCountEl.textContent = processedCount;
        }

        // Delete applicant
        function deleteApplicant(applicantId) {
            if (confirm('Are you sure you want to permanently delete this applicant? This action cannot be undone.')) {
                const index = applicants.findIndex(a => a.id === applicantId);
                if (index !== -1) {
                    const deletedApplicant = applicants[index];
                    applicants.splice(index, 1);
                    refreshAllSections();
                    showNotification(`üóëÔ∏è Deleted applicant: ${deletedApplicant.name}`, 'success');
                    
                    // Auto-save to Firebase
                    if (database) {
                        setTimeout(autoSaveToFirebase, 2000);
                    }
                }
            }
        }

        // Move applicant to processed
        function moveToProcessed(applicantId) {
            if (confirm('Mark this applicant as processed? This means the application has been reviewed and actioned.')) {
                const applicant = applicants.find(a => a.id === applicantId);
                if (applicant) {
                    applicant.status = 'processed';
                    applicant.processedDate = new Date().toLocaleString();
                    applicant.processedBy = 'Dashboard User'; // Could be enhanced with user login
                    
                    refreshAllSections();
                    showNotification(`‚úîÔ∏è Moved ${applicant.name} to Processed`, 'success');
                    
                    // Auto-save to Firebase
                    if (database) {
                        setTimeout(autoSaveToFirebase, 2000);
                    }
                }
            }
        }

        // Restore from processed (move back to original status based on score)
        function restoreFromProcessed(applicantId) {
            if (confirm('Restore this applicant to active status? They will be moved back to their original category.')) {
                const applicant = applicants.find(a => a.id === applicantId);
                if (applicant) {
                    applicant.status = determineStatus(applicant.score);
                    delete applicant.processedDate;
                    delete applicant.processedBy;
                    
                    refreshAllSections();
                    showNotification(`‚Ü©Ô∏è Restored ${applicant.name} to ${applicant.status}`, 'success');
                    
                    // Auto-save to Firebase
                    if (database) {
                        setTimeout(autoSaveToFirebase, 2000);
                    }
                }
            }
        }

        // API endpoint simulation for bot integration
        window.addApplicantReport = function(reportData) {
            console.log('üîó Direct API call received:', reportData);
            processIncomingReport(reportData);
        };

        // Export function for bot integration
        window.getDashboardStats = function() {
            return {
                totalApplicants: applicants.length,
                passed: applicants.filter(a => a.status === 'passed').length,
                failed: applicants.filter(a => a.status === 'failed').length,
                waitlist: applicants.filter(a => a.status === 'waitlist').length,
                processed: applicants.filter(a => a.status === 'processed').length,
                botStats: botStats
            };
        };

        const chatbots = [
            { id: 1, name: 'AI Fundamentals Screener', course: 'AI Fundamentals', created: '2025-01-01', active: true },
            { id: 2, name: 'Machine Learning Screener', course: 'Machine Learning', created: '2025-01-05', active: true },
            { id: 3, name: 'Data Science Screener', course: 'Data Science', created: '2025-01-10', active: false }
        ];

        // Tab switching
        function switchTab(tabName) {
            // Hide all content
            document.querySelectorAll('[id^="content-"]').forEach(el => el.style.display = 'none');
            // Show selected content
            document.getElementById('content-' + tabName).style.display = 'block';
            
            // Update tab styles
            document.querySelectorAll('[id^="tab-"]').forEach(el => {
                el.className = el.className.replace('tab-active', 'tab-inactive');
            });
            document.getElementById('tab-' + tabName).className = document.getElementById('tab-' + tabName).className.replace('tab-inactive', 'tab-active');
        }

        // Modal functions
        function showModal(title, content) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-content').value = content;
            document.getElementById('modal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('show');
        }

        function copyToClipboard() {
            const content = document.getElementById('modal-content').value;
            navigator.clipboard.writeText(content).then(() => {
                const btn = document.getElementById('copy-btn');
                btn.textContent = '‚úÖ Copied!';
                btn.className = btn.className.replace('btn-blue', 'btn-green');
                setTimeout(() => {
                    btn.textContent = 'Copy to Clipboard';
                    btn.className = btn.className.replace('btn-green', 'btn-blue');
                }, 2000);
            });
        }

        // Data functions
        function showCSVData() {
            const csv = [
                ['Name', 'Email', 'Phone', 'Date', 'Status', 'Score', 'Bootcamp'],
                ...applicants.map(a => [a.name, a.email, a.phone, a.date, a.status, a.score, a.bootcamp])
            ].map(row => row.join(',')).join('\n');
            showModal('üìä CSV Data - All Applicants', csv);
        }

        function showCategoryData(status) {
            const filtered = applicants.filter(a => a.status === status);
            const csv = [
                ['Name', 'Email', 'Phone', 'Date', 'Status', 'Score', 'Bootcamp'],
                ...filtered.map(a => [a.name, a.email, a.phone, a.date, a.status, a.score, a.bootcamp])
            ].map(row => row.join(',')).join('\n');
            showModal(`üìä CSV Data - ${status.charAt(0).toUpperCase() + status.slice(1)} Applicants`, csv);
        }

        function showIndividualReport(applicant) {
            const report = `AI BOOTCAMP SCREENING REPORT
============================

APPLICANT INFORMATION
Name: ${applicant.name}
Email: ${applicant.email}
Phone: ${applicant.phone}
Application Date: ${applicant.date}
Bootcamp: ${applicant.bootcamp}
${applicant.submissionTime ? `Submission Time: ${applicant.submissionTime}` : ''}
${applicant.source ? `Source: ${applicant.source}` : ''}

SCREENING RESULTS
Overall Score: ${applicant.score}%
Status: ${applicant.status.toUpperCase()}
${applicant.processedDate ? `Processed Date: ${applicant.processedDate}` : ''}
${applicant.processedBy ? `Processed By: ${applicant.processedBy}` : ''}

QUESTION-BY-QUESTION BREAKDOWN
Question 1: ${applicant.responses[0]}
Question 2: ${applicant.responses[1]}
Question 3: ${applicant.responses[2]}
Question 4: ${applicant.responses[3]}
Question 5: ${applicant.responses[4]}

RECOMMENDATION
${applicant.status === 'passed' ? 'ACCEPTED - Applicant meets all requirements for the bootcamp.' :
  applicant.status === 'waitlist' ? 'WAITLIST - Applicant shows potential but may need additional preparation.' :
  applicant.status === 'failed' ? 'NOT ACCEPTED - Applicant needs to strengthen foundational knowledge before reapplying.' :
  'PROCESSED - This application has been reviewed and appropriate action has been taken.'}

TECHNICAL DETAILS
Applicant ID: ${applicant.id}
${applicant.source === 'Bot Submission' ? 'Received via automated bot integration' : 'Manually entered data'}

Generated on: ${new Date().toLocaleString()}`;
            showModal(`üìã Screening Report - ${applicant.name}`, report);
        }

        // Test bot integration (enhanced to test both formats)
        function testBotIntegration() {
            const testType = Math.random() > 0.5 ? 'structured' : 'legacy';
            
            if (testType === 'structured') {
                // Test new structured format
                const testData = {
                    messageType: 'CANDIDATE_REPORT',
                    name: 'Test Candidate ' + Math.floor(Math.random() * 1000),
                    email: 'test' + Math.floor(Math.random() * 1000) + '@example.com',
                    phone: '+1 (555) 999-' + Math.floor(Math.random() * 10000).toString().padStart(4, '0'),
                    score: Math.floor(Math.random() * 100),
                    course: 'AI Fundamentals',
                    responses: ['Correct', 'Correct', 'Incorrect', 'Correct', 'Correct'],
                    autoShow: true
                };
                
                console.log('üß™ Testing structured format integration with data:', testData);
                displayCandidateReport(testData);
            } else {
                // Test legacy format
                const testData = {
                    name: 'Legacy Test ' + Math.floor(Math.random() * 1000),
                    email: 'legacy' + Math.floor(Math.random() * 1000) + '@example.com',
                    phone: '+1 (555) 888-' + Math.floor(Math.random() * 10000).toString().padStart(4, '0'),
                    score: Math.floor(Math.random() * 100),
                    bootcamp: 'Machine Learning',
                    responses: ['Correct', 'Incorrect', 'Correct', 'Correct', 'Incorrect'],
                    autoShow: true
                };
                
                console.log('üß™ Testing legacy format integration with data:', testData);
                processIncomingReport(testData);
            }
        }

        function createChatbot() {
            const name = document.getElementById('chatbot-name').value;
            const course = document.getElementById('chatbot-course').value;
            
            if (name.trim()) {
                const report = `ü§ñ Chatbot Created Successfully!

Configuration:
- Name: ${name}
- Course: ${course}
- Created: ${new Date().toLocaleString()}
- Status: Active
- ID: CB${Date.now().toString().slice(-6)}

Features Enabled:
‚úì Applicant Screening
‚úì Automated Responses
‚úì Score Calculation
‚úì Report Generation

(This is a demo - in production, the chatbot would be configured in your AI platform)`;
                showModal('ü§ñ Chatbot Created Successfully', report);
                document.getElementById('chatbot-name').value = '';
            } else {
                showModal('‚ö†Ô∏è Validation Error', 'Please enter a chatbot name before creating.');
            }
        }

        function handleFileUpload(input, type) {
            const file = input.files[0];
            if (file) {
                const report = `‚úÖ ${type} File Upload Success!

File Details:
- Name: ${file.name}
- Size: ${(file.size / 1024).toFixed(2)} KB
- Type: ${file.type}
- Last Modified: ${new Date(file.lastModified).toLocaleString()}

(This is a demo - in production, the file would be processed on your server)`;
                showModal('‚úÖ File Upload Success', report);
                input.value = '';
            }
        }

        function editChatbot(chatbot) {
            const report = `‚öôÔ∏è Edit Chatbot Configuration

Current Settings:
- Name: ${chatbot.name}
- Course: ${chatbot.course}
- Created: ${chatbot.created}
- Status: ${chatbot.active ? 'Active' : 'Inactive'}

(This is demo functionality - in production, this would open a configuration interface)`;
            showModal(`‚öôÔ∏è Edit Chatbot - ${chatbot.name}`, report);
        }

        function deleteChatbot(chatbot) {
            const report = `üóëÔ∏è Delete Chatbot Confirmation

‚ö†Ô∏è Are you sure you want to delete "${chatbot.name}"?

This action will:
- Permanently remove the chatbot
- Delete all configuration data
- Stop any active screening sessions

Chatbot Details:
- Course: ${chatbot.course}
- Created: ${chatbot.created}
- Status: ${chatbot.active ? 'Active' : 'Inactive'}

This action CANNOT be undone!`;
            showModal(`üóëÔ∏è Delete Chatbot - ${chatbot.name}`, report);
        }

        // Initialize page
        function init() {
            console.log('üöÄ Initializing AI Bootcamp Dashboard with Bot Integration');
            
            // Check for URL parameters first
            checkURLParams();
            
            // Populate all sections
            populateRecentApplicants();
            populateApplicantSections();
            populateChatbotsTable();
            updateConnectionStatus();
            
            console.log('‚úÖ Dashboard initialized successfully');
        }

        // Populate recent applicants
        function populateRecentApplicants() {
            const recentContainer = document.getElementById('recent-applicants');
            recentContainer.innerHTML = '';
            
            applicants.slice(0, 5).forEach(applicant => {
                const statusClass = getStatusColor(applicant.status);
                const statusEmoji = getStatusIcon(applicant.status);
                
                recentContainer.innerHTML += `
                    <div class="px-6 py-4 flex items-center justify-between hover:bg-gray-50">
                        <div class="flex items-center space-x-4">
                            <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center">
                                <span class="text-sm font-medium text-gray-600">${applicant.name.split(' ').map(n => n[0]).join('')}</span>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">${applicant.name}</p>
                                <p class="text-sm text-gray-500">${applicant.email}</p>
                                <p class="text-sm text-gray-500">${applicant.phone}</p>
                                ${applicant.source ? `<p class="text-xs text-blue-600">${applicant.source}</p>` : ''}
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-500">${applicant.bootcamp}</span>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusClass}">
                                ${statusEmoji} ${applicant.status}
                            </span>
                        </div>
                    </div>
                `;
            });
        }

        // Populate applicant sections
        function populateApplicantSections() {
            ['passed', 'waitlist', 'failed', 'processed'].forEach(status => {
                const container = document.getElementById(status + '-applicants');
                container.innerHTML = '';
                const filtered = applicants.filter(a => a.status === status);
                const colorClass = status === 'passed' ? 'green' : 
                                  status === 'failed' ? 'red' : 
                                  status === 'waitlist' ? 'yellow' : 'blue';
                
                filtered.forEach(applicant => {
                    const actionButtons = status === 'processed' ? 
                        `<button onclick="restoreFromProcessed(${applicant.id})" class="w-full btn btn-gray mb-2 text-sm">
                            ‚Ü©Ô∏è Restore to Active
                        </button>
                        <button onclick="deleteApplicant(${applicant.id})" class="w-full btn btn-red text-sm">
                            üóëÔ∏è Delete Permanently
                        </button>` :
                        `<div class="space-y-2">
                            <button onclick="showIndividualReport(${JSON.stringify(applicant).replace(/"/g, '&quot;')})" class="w-full btn btn-${colorClass}">
                                üìã View Report
                            </button>
                            <div class="flex space-x-2">
                                <button onclick="moveToProcessed(${applicant.id})" class="flex-1 btn btn-blue text-sm">
                                    ‚úîÔ∏è Mark Processed
                                </button>
                                <button onclick="deleteApplicant(${applicant.id})" class="flex-1 btn btn-red text-sm">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>`;

                    container.innerHTML += `
                        <div class="border border-${colorClass}-200 rounded-lg p-4 bg-${colorClass}-50 hover:shadow-md transition-shadow">
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex-grow">
                                    <h4 class="font-medium text-gray-900">${applicant.name}</h4>
                                    <p class="text-sm text-gray-600">${applicant.email}</p>
                                    <p class="text-sm text-gray-600">${applicant.phone}</p>
                                    ${applicant.source ? `<p class="text-xs text-blue-600 font-medium">${applicant.source}</p>` : ''}
                                    ${applicant.processedDate ? `<p class="text-xs text-blue-600">Processed: ${applicant.processedDate}</p>` : ''}
                                </div>
                                <span class="text-lg font-bold text-${colorClass}-600">${applicant.score}%</span>
                            </div>
                            <div class="flex items-center justify-between text-sm text-gray-500 mb-3">
                                <span>${applicant.bootcamp}</span>
                                <span>${applicant.date}</span>
                            </div>
                            ${actionButtons}
                        </div>
                    `;
                });
            });
        }

        // Populate chatbots table
        function populateChatbotsTable() {
            const chatbotsContainer = document.getElementById('chatbots-table');
            chatbotsContainer.innerHTML = '';
            
            chatbots.forEach(chatbot => {
                chatbotsContainer.innerHTML += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">${chatbot.name}</td>
                        <td class="px-6 py-4 text-sm text-gray-900">${chatbot.course}</td>
                        <td class="px-6 py-4 text-sm text-gray-900">${chatbot.created}</td>
                        <td class="px-6 py-4">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${chatbot.active ? 'text-green-800 bg-green-100' : 'text-gray-800 bg-gray-100'}">
                                ${chatbot.active ? 'üü¢ Active' : 'üî¥ Inactive'}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-sm font-medium space-x-2">
                            <button onclick="editChatbot(${JSON.stringify(chatbot).replace(/"/g, '&quot;')})" class="text-blue-600 hover:text-blue-900">Edit</button>
                            <button onclick="deleteChatbot(${JSON.stringify(chatbot).replace(/"/g, '&quot;')})" class="text-red-600 hover:text-red-900">Delete</button>
                        </td>
                    </tr>
                `;
            });
        }

        // Close modal when clicking outside
        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing AI Bootcamp Dashboard with Firebase & Bot Integration');
            
            // Initialize Firebase first
            initializeFirebase();
            
            // Setup auto-save triggers
            setupAutoSaveTriggers();
            
            // Initialize dashboard
            init();
            
            // Console welcome message for bot integration
            console.log(`
ü§ñ AI BOOTCAMP DASHBOARD - FULLY INTEGRATED!
=============================================

‚úÖ Dashboard loaded successfully
‚úÖ Firebase integration active
‚úÖ Auto-save enabled (every 60 seconds)
‚úÖ Enhanced bot listener ready - waiting for bot.html reports
‚úÖ Listening for reports from: https://terence1975-coder.github.io/tender/bot.html
‚úÖ Ready to receive applicant data (both legacy and structured formats)

üì® Send reports using:
   Legacy: window.parent.postMessage(reportData, '*')
   Structured: window.parent.postMessage({messageType: 'CANDIDATE_REPORT', ...data}, '*')

üß™ Test integration with the "Test Bot Connection" button
‚òÅÔ∏è Save/Load data with Firebase cloud storage
üóëÔ∏è Delete applicants or mark as processed
‚úîÔ∏è Move completed applications to processed section
üéØ Enhanced security checks and message type handling

üìä Current stats: ${applicants.length} applicants loaded
            `);
            
            // Additional ready message for bot sync
            console.log('üéØ Enhanced testbot.html listener ready - waiting for bot.html reports with security validation');
        });
    </script>
</body>
</html>
